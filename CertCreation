= Steps to creating Certs =

== Overview ==

The Spacewalk Satellite Server provides all services to customers through the setting of entitlements. The entitlements available through the Satellite are determined by the Entitlement Certificate which contains the precise set of entitlements attributed to your organization. The entitlement certificiate is encryped with a GPG key. For Red Hat supported channels, the certificiate is encryped with Red Hat's security GPG key. It is possible to create your own GPG key and certificate for private non Red Hat channels. This process involves creating a GPG key and sigining a certificate for use with Spacewalk. The GPG signed certificate is used to activate the satellite using rhn-satellite-activate. A certificate template and sigining script is included for your use. 

== Generate GPG keys ==

 1. First create a GPG key,
   
    {{{
gpg --gen-key
    }}}

 2. Then see if your key appears in listed. For example, we generated a key for Scooby below.

    {{{
[scooby@scooby ~]$ gpg --list-keys
/home/scooby/.gnupg/pubring.gpg
-------------------------------
pub   1024D/74E73973 2008-06-11
uid                  Scooby Doo <scooby@redhat.com>
sub   2048g/AFD3819B 2008-06-11
   }}}


 3. Finally, export the key.

   {{{
gpg --export -a 74E73973 > mycertkey.gpg
   }}}

== Install GPG keys into webapp ==

Set the {{{web.gpg_keyring}}} in {{{/etc/sysconfig/rhn/default/rhn_web.conf}}} to your newly exported keyring.

Alternatively, you can add your keys to the {{{/etc/webapp-keyring.gpg}}} keyring.

== Signing the Certificate ==

 1. Add the {{{gen-oss-sat-cert.pl}}} script to your satellite (see below under '''Attachments''')
 2. Modify the {{{template.cert}}} or create a new certifcate to sign
 3. Review the usage statement from {{{gen-oss-cert.pl}}}:
{{{
Usage: ./gen-oss-sat-cert.pl --dsn <dsn> --orgid <org_id> --owner <owner_name> --signer <signer> --no-pass-phrase --output <dest> --expires <when> --slots <num> [ --provisioning-slots <num> ] [ --channel-family label=n ] [ --satellite-version X.Y ] [ --resign ]
}}}
 4. Resign/sign the cert, for example:
{{{
perl gen-oss-sat-cert.pl --dsn spacewalk/spacewalk@xe --signer 74E73973 --resign template-eval.cert
}}}

== Activating the Satellite locally ==

You should use the options below to accomplish the following tasks in this order:

   1. Validate the RHN Entitlement Certificate's sanity (or usefulness).
   2. Activate the Satellite locally by inserting the Entitlement Certificate into the local database. 

Here are some examples depicting use of the tool and these options.

To validate an Entitlement Certificate's sanity only:
{{{
rhn-satellite-activate --sanity-only --rhn-cert=/path/to/demo.cert
}}}
To validate an Entitlement Certificate and populate the local database:
{{{
rhn-satellite-activate --disconnected --rhn-cert=/path/to/demo.cert
}}}
Once you run this final command, the Satellite is running and able to serve packages locally.


