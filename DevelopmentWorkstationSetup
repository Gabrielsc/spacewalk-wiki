= Intro = 

The below instructions are how to set up the Spacewalk Development Enviroment into a Red Hat Enterprise Linux 5 server.  [wiki:"DevelopmentWorkstationSetupFedora9" Future versions ] will include instructions and support for Fedora and other Linux variants.

Work in progress: [wiki:"DevelopmentWorkstationSetupFedora9" Development env setup for Fedora 9 ]


= Prerequisites =


=== Spacewalk Runtime Environment ===

In order to setup the  Spacewalk development environment, you first need to have a running version of Spacewalk installed following the instructions in [HowToInstall Spacewalk Installation Instructions].

=== Git  ===
To setup the sources follow the instructions in [GitGuide#InstallGit Install Git] and [GitGuide#ClonetheSpacewalkgitrepository clone the Spacewalk repository].


= Web Application =


=== Installation ===
 * {{{sudo /usr/sbin/rhn-satellite stop}}}
 * {{{sudo yum install ant-nodeps junit ant-junit java-1.6.0-openjdk-devel}}}
 * {{{sudo rpm -Uvh http://mirrors.dotsrc.org/jpackage/1.7/generic/free/RPMS/ivy-1.3.1-1jpp.noarch.rpm}}}
 * {{{cd $GITDIR/spacewalk/java}}}
 * {{{ant all, or ant clean all }}}
 * {{{ant create-webapp-dir}}}
 * {{{sudo ant install-devel (this step may only be necessary once after the initial install)}}} 
 * {{{cd $GITDIR/spacewalk/search-server}}}
 * {{{../rel-eng/bin/build.py --test --rpm && /tmp/spacewalk-build/noarch/spacewalk-search-*.git.*.noarch.rpm }}}
 * {{{it's a good idea to wipe out the search indexes, "sudo /sbin/service rhn-search cleanindex"}}}
 * {{{sudo /sbin/rhn-satellite start}}}

Your development environment should now be ready to go. Having problems? Check out the [DevelopmentWorkstationSetup#Troubleshooting troubleshooting] section below.


=== Uninstallation ===

In case you decide to undo your development environment changes and go back to running your Spacewalk.

'''NOTE:''' this operation right now is a bit dodgy

 * {{{sudo ant uninstall-devel}}}


= Deploying development schema =

This will completely drop all data from the database and recreate all tables, stored procs, etc.  Any systems, channels, or packages will no longer exist within the DB after this operation.  It is not reversible.  When it is finished, you should have a database deployed with a schema that is inline with your git checkout.

{{{ 
 /etc/init.d/rhn-satellite stop
 /etc/init.d/oracle-xe restart
 cd $GITDIR/schema/spacewalk 
 make satellite-clean satellite-release TBS=USERS SQLUSER=spacewalk/spacewalk@xe     
 rhn-satellite-activate --disconnected  (you may have to rename old validate-sat-cert.pl and soft link $GITDIR/spacewalk/admin/validate-sat-cert.pl to /usr/bin/
 /etc/init.d/rhn-satellite start
}}} 

{{{
  If pointing to an old Satellite's DB, use TBS=DATA_TBS  or you will be sorry!
}}}

{{{
  To determine if it was successful, look for
  SQL_FILE
  ---------------
  rhnsat/quit.sql
}}}


= Troubleshooting =
 * catalina.out has the following error:
{{{
SEVERE: Error starting static Resources
java.lang.IllegalArgumentException: Document base /usr/share/tomcat5/webapps/rhn does not exist or is not a readable directory
        at org.apache.naming.resources.FileDirContext.setDocBase(FileDirContext.java:141)
        at org.apache.catalina.core.StandardContext.resourcesStart(StandardContext.java:3855)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4024)
...
}}}
   This typically means the {{{tomcat}}} user can not read {{{/usr/share/tomcat5/webapps/rhn}}}, give {{{tomcat}}} user access to directory.

 * browse webapp and it looks plain like a webapp from 1995, usually caused by the css files not being loaded. 
{{{
[Wed Jul 16 14:56:20 2008] [error] [client 192.168.1.106] Symbolic link not allowed or link target not accessible: /var/www/html, referer: https://bugatti.usersys.redhat.com/rhn/systems/Overview.do
}}}
  The most likely culprit is actually a permissions problem for the apache user, give {{{apache}}} user access to the directory.

= Building spacewalk-java RPM =

* See here for info on rebuilding the spacewalk-java RPM: BuildingJavaRpm

