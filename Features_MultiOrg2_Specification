= Multiple Organizations High Level Specification =

== Introduction ==

The multiple organization support feature in Spacewalk allows you to partition your Spacewalk server into different organizations that each have their own set of entitlements, systems, and content that other organizations on the Spacewalk server cannot access. This document describes the high level design overview for this feature. 

== DB Schema ==

=== rhnTrustedOrgRing ===
rhnTrustedOrgRing will handle the trusted organizations that Spacewalk Admin will setup among the various organizations that are defined. Note this does not mean the orgs will trust each other, rather it merely gives the Org Admins of those Organizations the opportunity to share channel content and system migrations if they wish. 

 * org_id: number, not null and fk to web_customer(id)
 * trust_org_id: number, not null and fk to web_customer(id)
 * created: date(sysdate), not null
 * modified: date(sysdate), not null

unique index on rhnTrustedOrgRing(org_id, trust_org_id)

=== rhnOrgTrust ===
If the orgs are in a trusted relationship as defined by the Spacewalk Admin in the rhnTrustedOrgRing, then the org admins can setup channel content and system migrations to occur between orgs in their trust ring. The rhnOrgTrust table will tract the orgs an Org Admin selects out of their trust ring. 

 * org_id: number, not null and fk to web_customer(id)
 * trust_org_id: number, not null and fk to web_customer(id)
 * trust_type: number, not null and fk to rhnTrustType(id)
 * created: date(sysdate), not null
 * modified: date(sysdate), not null

unique index on rhnOrgTrust(org_id, trust_org_id)

=== rhnTrustType ===
This table will contain the various resources an organization can share. For this release, both channel content and system migration are available. 

 * id: number, not null, primary key
 * label: varchar2(32), not null
 * name: varchar2(64), not null
 * created: date(sysdate), not null
 * modified: date(sysdate), not null

The following static data will be populated:

 * channel_sharing (Channel Sharing)
 * system_migration (System Migration)

=== rhnChannel ===
This table will require an additional column to handle if the Org Admin will allow orgs from its Trusted Ring to have access to Channel Content, 

 * public: char(1) default('N'), check public in ('Y', 'N')

== New & Existing Pages ==

The design of the following new pages can be found on the [wiki:/Features/MultiOrg2/TrustRelationships User Interface] mockups and the [wiki:/Features/MultiOrg2/ContentSharing Content Sharing] mockups. High Level descriptions of the widgets can be found on the mockup pages. 

=== Organizations ===
Location: /rhn/admin/multiorg/Organizations.do (Existing)
ACL: Spacewalk Admin

=== Trust Ring ===
Location: /rhn/admin/multiorg/TrustRing.do?tid=X (New)
ACL: Spacewalk Admin

=== Trust Ring Remove Confirm ===
Location: /rhn/admin/multiorg/TrustRingDelete.do?tid=X (New)
ACL: Spacewalk Admin

=== Organization Trust ===
Location: /rhn/trust/Trusts.do
ACL: Org Admin

=== Channel Details ===
Location: /network/software/channels/manage/edit.pxt?cid=101 (Existing)
ACL: Org Admin

=== Channel Organization? ===
Currently the mockups show a Channel organization page that allows a Org Admin to give access to specific Organizations in addition to the Org Trust Page. Questions:
 * Is this overkill? Why have a global org trust page per org and then have an additional trust ring per channel? 
 * If we do support both a global Trust Ring per Org and a trust ring per channel, how will this work together? Precedence? Documentation? 
Location: /rhn/channels/manage/ChannelTrust.do?cid=101 (New?)
ACL: Org Admin

