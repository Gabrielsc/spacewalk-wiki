= Support User =
=== REVIEWED BY: ===

== Overview ==
Support for users with read-only access has been a common request of Satellite customers. After several customer discussions we found that this requirement more often than not boils down to a desire for a support user who can log in and perform some simple searches on systems, users, and organizations. As such we decided to pursue this path by implementing a new tab in the satellite UI exposing a simple search interface to users who have the appropriate role.

The support user's features can be looked as having two aspects:
 * Read only (or very limited) functionality to change the state of the satellite server
 * Advanced searching/auditing mechanism for systems spanning multiple organizations

== Requirements ==
 1. A new user role that corresponds to the support user role.
  * If a user is assigned the support user role, it '''cannot''' be assigned another role as well.
  * Permissions to assign the support user role to a user:
   * Satellite/Spacewalk admin can give to anyone.
   * Org admins can give to users in their org.
  * Users in the support user role will have access to the following UI tabs. This list is derived from the tabs available to a user with no roles. For more detail on the capabilities allowed within these sections see the [wiki:SupportUserReadOnly wiki on read only functionality in the existing UI].
   * Overview
   * Systems
   * Errata
   * Channels
   * Schedule
   * Help
 1. Users in the support user role have access to new search functionality for their needs.
   * Support user searches must be able to search across all organizations their home org trusts.
    * The user must be able to select a subset of these organizations at the time of search (potential to add saved/named subsets in the future)
   * For initial release this interface will allow only for searching of '''systems''' by:
    * Hostname
    * System ID
    * Custom Field
    * Package Installed
   * Search results must provide a link to existing SDC pages with read only functionality.
   * Search results will indicate the following as a summary of systems that match.
    * Status
    * System Name
    * Organization
 1. 


== Other Feature Impact ==
This will likely need to be addressed in APIs. See the API section below for more details.

There may be need to enhance the search server's abilities, depending on the final decision on what sort of searches are supported.

== Proposed Implementation ==
The implementation focuses around creating a new "Support User" role and an associated new section of the UI specifically for its tasks. The APIs will also be added to support the new features, utilizing existing APIs where applicable (i.e. addRole v. assignSupportUserRole).

=== Support User Role ===
 1. Support users can search across multiple organizations.
  1. By default when created or given the support role, users will see all orgs their home org trusts. (trusts are a feature planned for the second phase of multi-org support)
  1. Create a new UI screen to allow limiting to a selected '''subset''' of the trusted orgs.
  1. Removal of an org trust must result in removal of the org from any configured subsets. (jdob - Does "configured subsets" mean named/saved subsets? This should be a more prominent point if this is the case)
 1. Ensure proper permissions to give out support user role.
 1. Changes may need to be made to the rest of the visible UI to allow navigation across trusted orgs.

=== Support User UI (Auditing UI) ===
 1. Support tab will be added, similar to how the Admin tab appears for the satellite admin.

=== Read Only Functionality ===
 1. Existing functionality available to user with no roles should be audited to ensure we're comfortable with it being available to a user with the Support role.
  * Currently a user without roles can just register systems, and view channels / errata / scheduled actions in their home org.

=== APIs ===
 1. Create support user API handler offering the same functionality as is available in the UI.
  * Lay the groundwork for community involvement in expanding future support user searches.
  * 

=== Search Server ===
Below is a listing of the different types of searching proposed for the support user and if they are '''currently''' (as of Spacewalk 0.6) supported in the search server. A star indicates the criteria should be available in this iteration.

||   || Type of Search ||Search Criteria || Supported in Search-Server || Comments ||
|| * ||Systems || hostname || yes || ||
|| * ||Systems || system id || yes || ||
|| * ||Systems || custom info || yes || ||
||   ||Systems || running kernel || yes || ||
|| * ||Systems || package installed || yes || ||
||   ||Systems || last checkin || yes || ||
||   ||Errata || CVE ID  || yes || ||
||   ||Errata || RHBA/RHSA/RHEA ID || yes ||
||   ||Errata || Package Name || yes || ||
||   ||Errata || Issue Date || yes || ||
||   ||Errata || Severity (Bug | Enhancement | Security (Critical, Moderate, Important) || no || ||
||   ||Software Channels || * || no || ||
||   ||ORG || * || no || ||
||   ||Entitlements || * || no || ||
||   ||User || * || no || ||

=== Known Issues ===

=== Future Enhancements ===
The following search abilities have been requested:

 1. Systems
  1. Search By:
   1. hostname 
   1. system id  
   1. custom info field 
   1. running kernel (or package installed)  
  1. View:
   1. running kernel
   1. last check in   
   1. last booted
   1. available updates and errata
   1. applied errata
   1. subscribed channels
   1. full hardware profile   
   1. scheduled action status
   1. action history
   1. system owner / contact info
 1. Errata
  1. Search By:
   1. CVE ID     (Supported in Search-Server)
   1. RHBA/RHSA/RHEA ID   (Supported in Search-Server)
   1. Package Name   (Supported in Search-Server)
   1. Issue Date   (Supported in Search-Server)
   1. Severity (Bug | Enhancement | Security (Critical, Moderate, Important)   
  1. View:
   1. Normal errata details
   1. Systems still affected
   1. Systems with errata applied. (including date)
 1. Software Channels
  1. Search By:
   1. Browsing was requested, not sure if this affects our plans.
  1. View:
   1. List of packages.
   1. List of subscribed systems.
   1. Errata issued (with issued/cloned date)
 1. Organizations
  1. Search By:
   1. Org ID
   1. Org name
   1. Browsing requested.
  1. View
   1. System/software entitlement usage.
 1. Entitlements
  1. Search By:
   1. Browsing requested.
  1. View
   1. Allocation to organizations.
 1. User
  1. Search By:
   1. email address
   1. real name
   1. user id
   1. login name
  1. View:
   1. user details
 1. Activation Keys (look up for user?)

== Mock Ups ==
Screenshot taken from Support User tab on RHN Hosted:

[[Image(hosted-support-user-tab.png)]]

Search Form Mockup:

[[Image(Supportuser-searchform_whiteboard.png.jpeg, 50%)]]

Search Results Mockup:

[[Image(Supportuser-searchresults_whiteboard.png.jpeg, 50%)]]


== Tasks ==

Confidence: Values 1-5, where 1 is very unsure of the estimate and 5 is extremely confident it will be met.

Role Creation
|| '''Description''' || '''Estimate''' || '''Confidence''' ||
|| Add support user role to database || 1h || 5 ||
|| Make support user role available to UI || 4h || 4 ||

Web UI
|| '''Description''' || '''Estimate''' || '''Confidence''' ||
|| Add support tab to UI header || ?? || ?? ||
|| Support tab UI search page || ?? || ?? ||
|| Search results page || ?? || ?? ||
|| Search actions implementation || ?? || ?? ||

APIs
|| '''Description''' || '''Estimate''' || '''Confidence''' ||
|| Add API for support user search || ?? || ?? ||
|| Verify existing APIs do not allow support users to do bad things || ?? || ?? ||

Read Only Features
|| Investigate abilities of no-role user || ?? || ?? ||
|| Changes to support read only nature of no-role user || ?? || ?? ||

== Test Notes ==
High level testing areas:
 * Ability to create support users and see the appropriate support user UI functionality
 * Support user searching works correctly
 * Support user only has read only access (potentially tricky due to the scope of what needs to be investigated)
 * New support user APIs work correctly
 * Existing APIs do not allow non-read only functionality to support user

== Risks/Concerns ==
 * Pretty extensive testing required to ensure read only user is actually read only.
 * Could be tricky to figure out how to test the APIs to make sure the support user is not allowed to make changes. Will have to touch base with Brad to see how comfortable he is with our current role support in the APIs.

== Additional Resources ==
[wiki:SupportUserArchive Original Wiki Discussion]