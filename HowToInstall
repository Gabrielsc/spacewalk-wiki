= Spacewalk Installation Instructions =

 * [#SettingupSpacewalkrepo Setting up Spacewalk repo ]
 * [#Aditionalrepospackages Aditional repos & packages ]
 * [#OraclePre-Requisites Oracle Pre-Requisites ]
 * [#InstallingSpacewalk Installing Spacewalk ]
 * [#ManagingSpacewalk Managing Spacewalk ]
 * [#KnownIssues Known Issues ]

== Prerequisites ==

 * Outbound open ports 80, 443, 4545 (only if you want to enable monitoring)
 * Inbound open ports 80, 443, 5222 (only if you want to push actions to client machines) and 5269 (only for push actions to a Spacewalk Proxy)
 * Storage for database: 128KB per client system + 64MB per channel
 * Storage for packages (default /var/satellite): Depends on what you're storing; Red Hat recommend 6GB per channel for their channels

= Setting up Spacewalk repo =

RPM downloads of the project are available through a yum repository

  * http://spacewalk.redhat.com/yum - Binary RPMs
  * http://spacewalk.redhat.com/source - Source RPMs and tarballs

To use this repository install spacewalk-repo RPM

=== Red Hat Enterprise Linux, CentOS ===

{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.5/RHEL/5/i386/os/Packages/spacewalk-repo-0.5-1.el5.noarch.rpm
}}}
or
{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.4/RHEL/5/x86_64/os/Packages/spacewalk-repo-0.5-1.el5.noarch.rpm
}}}

=== Fedora ===

{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.5/Fedora/10/i386/os/Packages/spacewalk-repo-0.5-1.fc10.noarch.rpm
}}}
or
{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.5/Fedora/10/x86_64/os/Packages/spacewalk-repo-0.5-1.fc10.noarch.rpm
}}}

=== Nightly builds ===

If you want to use the nightly builds 
add a file in yum.repos.d (e.g. /etc/yum.repos.d/spacewalk.repo) with the following contents:

{{{
[spacewalk]
name=Spacewalk
baseurl=http://miroslav.suchy.cz/spacewalk/nightly-candidate/i386/os/
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=0
}}}

Fedora 10 nightly repo is at:

{{{ 
http://miroslav.suchy.cz/spacewalk/nightly-candidate-f10/
}}}

= Aditional repos & packages =

=== Fedora 10 ===

For Spacewalk 0.5 a couple additional dependencies are needed from jpackage. Please create the following yum repository before beginning your Spacewalk installation:

{{{
cat > /etc/yum.repos.d/jpackage.repo << EOF
[jpackage]
name=jpackage-f10
baseurl=http://mirrors.dotsrc.org/jpackage/6.0/fedora-10/free/
gpgkey=http://www.jpackage.org/jpackage.asc
gpgcheck=1
EOF
}}}

=== Red Hat Enterprise Linux 5 ===

Spacewalk requires a Java Virtual Machine with version 1.6.0 or greater.  [http://fedoraproject.org/wiki/EPEL EPEL - Extra Packages for Enterprise Linux] contains a version of the openjdk that works with Spacewalk.  To get packages from EPEL just install this RPM:

{{{
rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-2.noarch.rpm
}}}
or
{{{
rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-2.noarch.rpm
}}}

Please make sure you have only one java version installed. 
Otherwise you get error messeges like :
 * " bad major version at off set=6" or 
 * "INFO: validateJarFile(/usr/share/tomcat5/webapps/rhn/WEB-INF/lib/jspapi.jar) - jar not loaded."

You must also edit /etc/yum.repos.d/epel-testing.repo and change enabled=1. EPEL testing is currently required for Spacewalk 0.5.

=== CentOS 5 ===

Follow the instructions for '''Red Hat Enterprise Linux 5''' with the exceptions:
 1. You will need rhel-instnum which is packaged and provided by stahnma's client tools repo for CentOS. Switch to x86_64 if you are using that arch. 
{{{ 
rpm -Uvh http://stahnma.fedorapeople.org/spacewalk-tools/5/i386/spacewalk-client-tools-0.0-1.noarch.rpm 
}}} 
 1.  You will need Redhat's RPM GPG key:
{{{
# wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release http://www.redhat.com/security/37017186.txt
# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
}}}

= Oracle Pre-Requisites =

In order to get Spacewalk to run it needs to point itself at a Oracle 10g database server.  The easiest way todo this is to install Oracle XE. Instructions on how todo this can be found on the [OracleXeSetup Oracle 10g Express Edition Setup] page.

= Installing Spacewalk =

'''Note''': Your Spacewalk server should have a resolvable FQDN such as 'hostname.domain.com'.  If the installer complains that the hostname is not the FQDN, do not use the --skip-fqdn-test flag to skip !  

Just ask yum to install the application:

{{{
rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-former
yum install gpg
yum install spacewalk
}}}

This will pull down and install the set of RPMs required to get Spacewalk to run.

= Configuring Spacewalk =

Once the Spacewalk RPM is installed you need to configure the application, you can run:

{{{
spacewalk-setup --disconnected
}}}



An example session is as follows:

{{{
[root@fjs-0-11 tmp]# spacewalk-setup --disconnected
* Loading answer file: /usr/share/spacewalk/setup/defaults.conf.
* Setting up environment and users.
** GPG: Initializing GPG and importing RHN key.
* Setting up database.
** Database: Setting up database connection.
DB User? spacewalk
DB Password? 
DB SID? xe
DB hostname? localhost
DB port [1521]? 
DB protocol [TCP]? 
** Database: Testing database connection.
** Database: Populating database.
*** Progress: ###################################################################
You must enter an email address.
Admin Email Address? tito@example.com
* Performing initial configuration.
* Activating Satellite.
** Loading Satellite Certificate.
** Verifying certificate locally.
** Activating Satellite.
* Enabling Monitoring.
* Creating SSL certificates.
CA certificate password? 
Re-enter CA certificate password? 
Organization? Tito Puente Solutions
Organization Unit [fjs-0-11.example.com]? 
Email Address [tito@example.com]? 
City? Raleigh
State? NC
Country code (Examples: "US", "JP", "IN", or type "?" to see a list)? US
** SSL: Generating CA certificate.
** SSL: Deploying CA certificate.
** SSL: Generating server certificate.
** SSL: Storing SSL certificates.
* Deploying configuration files.
* Starting Cobbler..
* Update configuration in database.
* Restarting services.
Installation complete.
Visit https://fjs-0-11.example.com to create the satellite administrator account.
}}}

If you are on x86_64 and tomcat5 fails to restart you need todo a:

{{{
cd /var/lib/tomcat5/webapps/rhn/WEB-INF/lib &&\
   rm ojdbc14.jar &&\
   ln -s /usr/lib/oracle/10.2.0.4/client64/lib/ojdbc14.jar ojdbc14.jar;
}}}

After {{{spacewalk-setup}}} is complete your application is ready to go!
'''Be sure to use the FQDN of the host when you connect.'''

Once you've made sure you can login to the Spacewalk web UI, you can then proceed to the next step: [UploadFedoraContent Uploading Content].

= Managing Spacewalk =
Spacewalk consists of several services. Each of them has its own init.d script to stop/start/restart. If you want manage all spacewalk services at once use 
{{{
/usr/sbin/rhn-satellite [stop|start|restart].
}}}

= Known Issues =

 * For issues with Oracle XE, see [OracleXeSetup#KnownIssues Oracle XE Setup Known Issues]