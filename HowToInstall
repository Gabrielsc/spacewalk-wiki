= Spacewalk Installation Instructions =

 * [https://fedorahosted.org/spacewalk/wiki/HowToInstall#RedHatEnterpriseLinux5 Red Hat Enterprise Linux 5]
 * [https://fedorahosted.org/spacewalk/wiki/HowToInstall#CentOS5 CentOS 5]

= CentOS 5 =

Please note the following exceptions and then refer to the instructions for [https://fedorahosted.org/spacewalk/wiki/HowToInstall#RedHatEnterpriseLinux5 Red Hat Enterprise Linux 5].

 1. You will need rhel-instnum which is packaged and provided by stahnma's client tools repo for CentOS. Switch to x86_64 if you are using that arch.
{{{
rpm -Uvh http://stahnma.fedorapeople.org/spacewalk-tools/5/i386/spacewalk-client-tools-0.0-1.noarch.rpm
}}}
 1.  You also need Redhat's RPM GPG key:
{{{
# wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release http://www.redhat.com/security/37017186.txt
# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
}}}

= Red Hat Enterprise Linux 5 =

== Oracle Pre-Requisites ==

In order to get Spacewalk to run it needs to point itself at a Oracle 10g database server.  The easiest way todo this is to install Oracle XE.  Instructions on how todo this can be found here:

[OracleXeSetup Oracle XE Setup instructions]

== EPEL Repo setup ==

Spacewalk requires a Java Virtual Machine with version 1.6.0 or greater.  [http://fedoraproject.org/wiki/EPEL EPEL - Extra Packages for Enterprise Linux] contains a version of the openjdk that works with Spacewalk.  To get packages from EPEL just install this RPM:

{{{
rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-2.noarch.rpm
}}}
or
{{{
rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-2.noarch.rpm
}}}

Please make sure you have only one java version installed. 
Otherwise you get error messeges like :
 * " bad major version at off set=6" or 
 * "INFO: validateJarFile(/usr/share/tomcat5/webapps/rhn/WEB-INF/lib/jspapi.jar) - jar not loaded."

== Installation ==

'''Note''': Your Spacewalk server should have a resolvable FQDN such as 'hostname.domain.com'.  If the installer complains that the hostname is not the FQDN, do not use the --skip-fqdn-test flag to skip !  

RPM downloads of the project are available through a yum repository

  * http://spacewalk.redhat.com/yum

To use this repository either install spacewalk-repo RPM

{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.4/rhel/5Server/i386/spacewalk-repo-0.4-1.el5.noarch.rpm
}}}
or
{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.4/rhel/5Server/x86_64/spacewalk-repo-0.4-1.el5.noarch.rpm
}}}

or manually add a file in {{{yum.repos.d}}} (e.g. {{{/etc/yum.repos.d/spacewalk.repo}}}) with the following contents:

{{{
[spacewalk]
name=Spacewalk
baseurl=http://spacewalk.redhat.com/yum/0.4/rhel/5Server/$basearch/
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=1
}}}

'''NOTE:''' If you are looking for versions 0.2 or 0.3 replace 0.4 with appropriate version in the {{{baseurl}}}.

If you want to use the nightly builds, use the following config:

{{{
[spacewalk]
name=Spacewalk
baseurl=http://miroslav.suchy.cz/spacewalk/nightly-candidate/i386/os/
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=0
}}}

Note that Fedora 10 repo is at:

{{{ 
http://miroslav.suchy.cz/spacewalk/nightly-candidate-f10/
}}}

Then just ask yum to install the application:

{{{
rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-former
rpm -e specspo
yum install gpg
yum install spacewalk
}}}

This will pull down and install the set of RPMs required to get Spacewalk to run and avoids the conflict with {{{specspo}}}.


'''NOTE:''' x86_64 users will need to add a file {{{/etc/ld.so.conf.d}}} (e.g. {{{/etc/ld.so.conf.d/spacewalk.conf}}}) with the following contents:
{{{
  /usr/lib/oracle/10.2.0.4/client64/lib/
  /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/
}}}
Run {{{ldconfig -v}}} to enable these changes on your system

Once the Spacewalk rpm is installed you need to configure the application, you can run:

{{{
spacewalk-setup --disconnected
}}}



An example session is as follows:

{{{
[root@fjs-0-11 tmp]# spacewalk-setup --disconnected
* Loading answer file: /usr/share/spacewalk/setup/defaults.conf.
* Setting up environment and users.
** GPG: Initializing GPG and importing RHN key.
* Setting up database.
** Database: Setting up database connection.
DB User? spacewalk
DB Password? 
DB SID? xe

DB hostname? localhost
DB port [1521]? 
DB protocol [TCP]? 
** Database: Testing database connection.
** Database: Populating database.
sh: dbhome: command not found
*** Progress: ###################################################################
You must enter an email address.
Admin Email Address? tito@example.com
* Performing initial configuration.
* Activating Satellite.
** Loading Satellite Certificate.
** Verifying certificate locally.
** Activating Satellite.
* Enabling Monitoring.
* Creating SSL certificates.
CA certificate password? 
Re-enter CA certificate password? 
Organization? Tito Puente Solutions
Organization Unit [fjs-0-11.example.com]? 
Email Address [tito@example.com]? 
City? Raleigh
State? NC
Country code (Examples: "US", "JP", "IN", or type "?" to see a list)? US
** SSL: Generating CA certificate.
** SSL: Deploying CA certificate.
** SSL: Generating server certificate.
** SSL: Storing SSL certificates.
Use of uninitialized value in chown at /usr/bin/rhn-generate-pem.pl line 57.
Use of uninitialized value in chown at /usr/bin/rhn-generate-pem.pl line 57.
* Deploying configuration files.
* Update configuration in database.
* Restarting services.
Installation complete.
Visit https://fjs-0-11.example.com to create the satellite administrator account.
}}}

If you are on x86_64 and tomcat5 fails to restart you need todo a:

{{{
cd /var/lib/tomcat5/webapps/rhn/WEB-INF/lib &&\
   rm ojdbc14.jar &&\
   ln -s /usr/lib/oracle/10.2.0.4/client64/lib/ojdbc14.jar ojdbc14.jar;
}}}

After {{{spacewalk-setup}}} is complete your application is ready to go!
'''Be sure to use the FQDN of the host when you connect.'''

You can also find source RPMs and tarballs at the following URL:
   * http://spacewalk.redhat.com/source

== Starting Spacewalk ==
If you are installing spacewalk 0.3 and later you should be using /sbin/rhn-satellite to stop/start/restart the spacewalk server as the init.d script has been removed.

= Known Issues =

 * During spacewalk-setup, you will be prompted for a satellite certificate, if you do not already have access to one you can generate one by following CertCreation.
 * For issues with Oracle XE, see [OracleXeSetup#KnownIssues Oracle XE Setup Known Issues]