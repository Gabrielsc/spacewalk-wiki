= Spacewalk Proxy Installation Instructions =

'''These instructions are for Spacewalk Proxy 0.2 onwards'''

If you're looking for instructions for the RHN Proxy product see http://www.redhat.com/docs/manuals/satellite/

== Prerequisites ==

  * Disable SELinux (work is ongoing to allow SELinux to remain enforcing see [wiki:Features/SELinux])
  * Around 6GB storage per distribution under /var/spool/squid (or whereever you want your Squid cache to be)
  * Outbound open ports 80, 443, 4545 (only if you want to enable monitoring) and 5269
  * Inbound open ports 80, 443 and 5222
  * An upstream Spacewalk or RHN Satellite server with an available Proxy entitlement (probably won't work against RHN Hosted)

== Installation ==

RPM downloads of the project are available through a yum repository

  * http://spacewalk.redhat.com/yum

To use the repository install spacewalk-repo RPM:

{{{
rpm -Uvh http://spacewalk.redhat.com/yum/0.5/RHEL/5/`uname -i`/os/Packages/spacewalk-repo-0.5-2.el5.noarch.rpm
}}}

Then just ask yum to install the application:

{{{
yum install spacewalk-proxy-installer
}}}

This will pull down and install the set of RPMs required for the installer to run. Below is an example of the set of packages pulled in:

{{{
========================================================================================================================
 Package                                 Arch                 Version                     Repository               Size
========================================================================================================================
Installing:
 spacewalk-proxy-installer               noarch               0.5.25-1.el5                spacewalk                40 k
Installing for dependencies:
 rhncfg                                  noarch               5.9.5-1.el5                 spacewalk                58 k
 rhncfg-actions                          noarch               5.9.5-1.el5                 spacewalk                28 k
 rhncfg-client                           noarch               5.9.5-1.el5                 spacewalk                24 k
 rhncfg-management                       noarch               5.9.5-1.el5                 spacewalk                33 k
}}}

If this is the first time installing an RPM from the Spacewalk repo, yum will prompt you to install the GPG key:

{{{
Importing GPG key 0x430A1C35 "Spacewalk <spacewalk-devel@redhat.com>" from http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
Is this ok [y/N]: y
}}}

Then you need to configure the proxy. Run:

{{{
configure-proxy.sh
}}}

Example run on 64-bit RHEL5 choosing not to install monitoring:

{{{
Proxy version to activate [0.2]: 
RHN Parent [spacewalk.example.com]: 
Traceback email []: admin@example.com
Use SSL [0]: 1
CA Chain [/usr/share/rhn/RHNS-CORP-CA-CERT]: 
HTTP Proxy []: 
Regardless of whether you enabled SSL for the connection to the Spacewalk Parent
Server, you will be prompted to generate an SSL certificate.
This SSL certificate will allow client systems to connect to this Spacewalk Proxy
securely. Refer to the Spacewalk Proxy Installation Guide for more information.
Organization: Example Company
Organization Unit [proxy1.example.com]:
Common Name: proxy1.example.com
City: New York
State: New York
Country code: US
Email [admin@example.com]:
Loading "rhnplugin" plugin
Loading "security" plugin
rhel-x86_64-server-5      100% |=========================| 1.4 kB    00:00     
rhel-x86_64-server-option 100% |=========================| 1.2 kB    00:00     
Setting up Install Process
Parsing package install arguments
Package spacewalk-proxy-management - 0.2.2-1.el5.sw.noarch is already installed.
Nothing to do
You do not have monitoring installed. Do you want to install it?
Will run 'yum install spacewalk-proxy-monitoring'.  [Y/n]:n
Generating CA key and public certificate:
CA password: 
CA password confirmation: 
Copying CA public certificate to /var/www/html/pub for distribution to clients:
Generating SSL key and public certificate:
CA password: 
Backup made: 'rhn-ca-openssl.cnf' --> 'rhn-ca-openssl.cnf.1'

Rotated: rhn-ca-openssl.cnf --> rhn-ca-openssl.cnf.1
Installing SSL certificate for Apache and Jabberd:
Preparing packages for installation...
rhn-org-httpd-ssl-key-pair-proxy1.example-1.0-1
Shutting down rhn-proxy...
Shutting down Jabber router:                               [FAILED]
Stopping httpd:                                            [FAILED]
Stopping squid:                                            [FAILED]
Done.
Starting rhn-proxy...
init_cache_dir /var/spool/squid... Starting squid: .       [  OK  ]
Starting httpd:                                            [  OK  ]
Starting Jabber services                                   [  OK  ]
Done.
}}}

You should now be able to navigate to the hostname of your proxy in a web browser and see the Spacewalk Proxy page (if you see an error here there's likely something wrong with your install). If all seems well you can now try [RegisteringClients Registering Clients]