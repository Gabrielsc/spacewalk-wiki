= Spacewalk Proxy Installation Instructions =

'''These instructions are for Spacewalk Proxy 0.2 onwards'''

== Installation ==

RPM downloads of the project are available through a yum repository

  * http://spacewalk.redhat.com/yum

To use this repository, add a file in {{{yum.repos.d}}} (e.g. {{{/etc/yum.repos.d/spacewalk.repo}}}) with the following contents:

{{{
[spacewalk]
name=Spacewalk
baseurl=http://spacewalk.redhat.com/yum/0.2/rhel/5Server/$basearch/
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=1
}}}

Then just ask yum to install the application:

{{{
yum install spacewalk-proxy-installer
}}}

This will pull down and install the set of RPMs required to get Spacewalk Proxy to run. Below is an example of the set of packages pulled in:

{{{
=============================================================================
 Package                 Arch       Version          Repository        Size 
=============================================================================
Installing:
 spacewalk-proxy-installer  noarch     0.2.1-1.el5.sw   spacewalk          13 k
Installing for dependencies:
 distcache               x86_64     1.4.5-14.1       rhel-x86_64-server-5  121 k
 httpd                   x86_64     2.2.3-11.el5_1.3  rhel-x86_64-server-5  1.1 M
 jabberd                 x86_64     2.0s10-3.42.el5  spacewalk         562 k
 mod_python              x86_64     3.2.8-3.1        rhel-x86_64-server-5  260 k
 mod_ssl                 x86_64     1:2.2.3-11.el5_1.3  rhel-x86_64-server-5   85 k
 rhncfg                  noarch     0.2.1-1.el5.sw   spacewalk          51 k
 rhncfg-actions          noarch     0.2.1-1.el5.sw   spacewalk          28 k
 rhncfg-client           noarch     0.2.1-1.el5.sw   spacewalk          23 k
 rhncfg-management       noarch     0.2.1-1.el5.sw   spacewalk          33 k
 spacewalk-backend       noarch     0.2.5-1.el5.sw   spacewalk         102 k
 spacewalk-certs-tools   noarch     0.2.3-1.el5.sw   spacewalk         130 k
 spacewalk-proxy-broker  noarch     0.2.2-1.el5.sw   spacewalk          36 k
 spacewalk-proxy-common  noarch     0.2.2-1.el5.sw   spacewalk          58 k
 spacewalk-proxy-docs    noarch     0.1-2.el5.sw     spacewalk         5.2 M
 spacewalk-proxy-html    noarch     0.1-2.el5.sw     spacewalk         9.7 k
 spacewalk-proxy-management  noarch     0.2.2-1.el5.sw   spacewalk          12 k
 spacewalk-proxy-package-manager  noarch     0.2.2-1.el5.sw   spacewalk          35 k
 spacewalk-proxy-redirect  noarch     0.2.2-1.el5.sw   spacewalk          24 k
 spacewalk-proxy-tools   noarch     0.2.2-1.el5.sw   spacewalk          33 k
 spacewalk-ssl-cert-check  noarch     1.4-10.10.el5.sw  spacewalk         7.8 k
 squid                   x86_64     7:2.6.STABLE6-5.el5_1.3  rhel-x86_64-server-5  1.3 M
}}}

If this is the first time installing an RPM from the Spacewalk repo, yum will prompt you to install the GPG key:

{{{
Importing GPG key 0x430A1C35 "Spacewalk <spacewalk-devel@redhat.com>" from http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
Is this ok [y/N]: y
}}}

Then you need to configure the proxy. Run:

{{{
configure-proxy.sh
}}}

Example run on 64-bit RHEL5 choosing not to install monitoring:

{{{
Proxy version to activate [0.2]: 
RHN Parent [spacewalk.example.com]: 
Traceback email []: admin@example.com
Use SSL [0]: 1
CA Chain [/usr/share/rhn/RHNS-CORP-CA-CERT]: 
HTTP Proxy []: 
Regardless of whether you enabled SSL for the connection to the Spacewalk Parent
Server, you will be prompted to generate an SSL certificate.
This SSL certificate will allow client systems to connect to this Spacewalk Proxy
securely. Refer to the Spacewalk Proxy Installation Guide for more information.
Organization: Example Company
Organization Unit [proxy1.example.com]:
Common Name: proxy1.example.com
City: New York
State: New York
Country code: US
Email [admin@example.com]:
Loading "rhnplugin" plugin
Loading "security" plugin
rhel-x86_64-server-5      100% |=========================| 1.4 kB    00:00     
rhel-x86_64-server-option 100% |=========================| 1.2 kB    00:00     
Setting up Install Process
Parsing package install arguments
Package spacewalk-proxy-management - 0.2.2-1.el5.sw.noarch is already installed.
Nothing to do
You do not have monitoring installed. Do you want to install it?
Will run 'yum install spacewalk-proxy-monitoring'.  [Y/n]:n
Generating CA key and public certificate:
CA password: 
CA password confirmation: 
Copying CA public certificate to /var/www/html/pub for distribution to clients:
Generating SSL key and public certificate:
CA password: 
Backup made: 'rhn-ca-openssl.cnf' --> 'rhn-ca-openssl.cnf.1'

Rotated: rhn-ca-openssl.cnf --> rhn-ca-openssl.cnf.1
Installing SSL certificate for Apache and Jabberd:
Preparing packages for installation...
rhn-org-httpd-ssl-key-pair-proxy1.example-1.0-1
Shutting down rhn-proxy...
Shutting down Jabber router:                               [FAILED]
Stopping httpd:                                            [FAILED]
Stopping squid:                                            [FAILED]
Done.
Starting rhn-proxy...
init_cache_dir /var/spool/squid... Starting squid: .       [  OK  ]
Starting httpd:                                            [  OK  ]
Starting Jabber services                                   [  OK  ]
Done.
}}}