== Introducing Spacewalk and Cobbler ==

Version 0.4 of Spacewalk adds significantly enhanced machine kickstarting capabilities due the the advent of tight integration between Spacewalk and the [https://fedorahosted.org/cobbler/ Cobbler] installation server system.  Cobbler is in fact now a component of Spacewalk - when you install Spacewalk, Cobbler will be included as a dependency.  

With Cobbler integration, Spacewalk gains some exciting new features:

 * Xen installs now use the virtinst library (same as virt manager)
 * Support for qemu/kvm based virtual machines
 * Support for lvm-backed guest installs
 * Support for virtual machines with multiple disks
 * Support for virtual machines with multiple NICs
 * Increased breadth of operating system support:
	* First-class support for
		* RHEL
		* Fedora
		* CentOS
	* Second-class support (ks templates and PXE only) for
		* Debian / Ubuntu
		* SuSE
 * Additional deployment options:
	* Bare-metal PXE kickstarting is supported
		* Auto-generated and updated menus
		* No longer necessary to install an OS in order to kickstart
 	* LiveCD / DeadCD support for bare metal rollouts where PXE isn't possible
	* Bare-metal kickstarts possible on multiple subnets
 * Integrated DHCP and DNS management
 * Powerful kickstart file templating

== Quick Start Guide ==

Here's a quick guide to get you going with the new goodies:

 1. Create a Distro
    a. Some prep work
	1. You're going to need some distribution isos and some loop mounts of them to get the ball rolling here, so...
		a. make a directory /var/iso-images
		a. download a copy of Fedora-9-i386-DVD.iso to that directory
		a. make a directory /var/distro-trees
			* within that directory make a directory Fedora-9
		a. mount -oloop /var/iso-images/Fedora-9-i386-DVD.iso /var/distro-trees/Fedora-9
			* You may find it useful to include an entry in /etc/fstab to ensure this mount persists across reboots
        1. Create a channel for the distribution you wish to kickstart (if you have one set up already, go to the next step)
		a. Select Channels|Manage Software Channels and select "+ create new channel"
		a. Fill in the required fields as described - call it "Fedora 9" with a label "fedora-9"
		a. Populate the channel with packages using rhnpush
			* e.g. rhnpush --server localhost -u admin -p spacewalk  --channel fedora-9 /var/distro-trees/Fedora-9/Packages/*.rpm
			* Note that this step takes "a while" - don't be alarmed - just take a *long* lunch. We're working on the speed issue for the next release.
	1. Having made the base channel, you must now create a child channel that contains some kickstart helper tools
		a. Select Channels|Manage Software Channels and select "+ create new channel"
		a. Fill in the required fields as described - call it "Fedora 9 with Tools" and label "fedora-9-with-tools"
		a. Download the following packages from http://spacewalk.redhat.com/yum/0.4:
			* pyOpenSSL
			* rhnlib
			* libxml2-python
			* spacewalk-koan*
		a. Populate your new child channel with these rpms using  "rhnpush --server localhost -u admin -p spacewalk  --channel fedora-9-with-tools /path/to/the/helper/rpms/*.rpm"
		a. You're now ready to create a kickstart distro
    a. Select Systems|Kickstart|Distributions and select "+ create new distribution"
	1. On the "Create Kickstart Distribution" page, fill in the items as described
		a. Distribution label in this case might be Fedora-9
		a. Tree path should be /var/distro-trees/Fedora-9
		a. Base channel should be "Fedora 9 with Tools"
		a. Installer generation should be Fedora 9 in this case.
		a. Once you've pressed the "Create Kickstart Distribution" button you'll see a table that includes your new entry.
		a. If you run "cobbler distro list" at your spacewalk system's command line, you'll now see these entries in addition to any others you may have already defined:
			* Fedora-9:1:Spacewalk-Public-Cert
			* Fedora-9:xen:1:Spacewalk-Public-Cert
 1. Having created your kickstartable distribution, you can now create a new kickstart profile:
    a. select Systems|Kickstart|Profiles and then select "+ create new kickstart profile"
    a. Give your new profile a label - in this case "Fedora-9-No-Tools"
    a. Select the base channel you created earlier
    a. Select the kickstartable tree you created earlier
    a. Select the virtualization type you intend the target machine to utilize.
    a. Click "Next", and on the next screen just accept the "Default Download Location" and click "Next"
    a. Give you new machine type a default root password, and then click "Finish"
    a. If you run cobbler profile list you'll now see this entry in addition to those you've already defined:
            * Fedora-9:1:Spacewalk-Public-Cert
 1. Use Spacewalk to kickstart a system with your profiles
     a. Kickstarting  "bare-metal" machines
        1. You can kickstart "bare metal" machines (actual physical machines or 'blank' virtual machines) with spacewalk provided you've set up a few things:
            a. Pay particular attention to any instructions related to kickstarting in the Spacewalk installation and setup documentation
            a. On your network
                1. Setup a dhcp server with entries - dynamic or static - that set next-server to point to your spacewalk machine
                1. (optional but probably desired) set up DNS (bind) with an entry that points to your spacewalk machine (both forward and reverse resolution)
            a. On the spacewalk server
                * edit /etc/xinetd.d/tftp and change the value of "disabled" to "no"
            a. A fairly well documented example of how to set up a small kickstart lab with Spacewalk can be found [https://fedorahosted.org/spacewalk/wiki/kickstartingLabNetworkingSetup here]
        1. Bare metal machines can be kickstarted in one of two ways:
            a. Semi-automatically (with a small amount of console interaction at the beginning of the process)
                1. Plug a machine into one of the network segments that the spacewalk's dhcp server is configured to respond on.
                1. Power on the machine and ensure via BIOS configuration that the machine will PXE boot over the network
                1. Boot the machine.  The PXE bootstrap process will take you to a menu that will include the kickstart profile you've just defined (along with any others).
                1. Select the profile you want to build the box to and press enter.
                1. The box will kickstart itself without any further interaction on your part.
            b. Fully automatically (with some prep work involving console or inventory access)
     a. Kickstart a virtual machine
	   1. In Spacewalk
	   1. With koan

== Cobbler Templating Variables, Kernel Options, and how they can help ==

 * How to add variables to Kickstart Distributions, Profiles and Systems in the Spacewalk GUI
 * How to do the same in Cobbler
 * How to use these variables in a kickstart file

== Upload your own Kickstart File ==

 * Discussion of new 'upload' mode of creating a kickstart profile
 * How this differs from the 'wizard' mode, and cobbler implications
 * Moving from 'wizard' mode to the full templating mode
 * Details where these files are stored on the file system

== How Integration Works ==

 * What happens when you create a Distro in the GUI, outline creation in spacewalk DB and XMLRPC calls into cobbler
 * What happens when you create a Profile in the GUI, outline creation in spacewalk DB and XMLRPC calls into cobbler
 * When and why we create cobbler system records. 
 * What happens when the user creates cobbler objects and when they show up in Spacewalk, and where these operations are limited
 * taskomatic's job in syncing changes from spacewalk to cobbler
 * taskomatic's job in syncing changes from cobbler to cobbler

== Cobbler Tips And Tricks ==

 * Cobbler editing of fields in Spacewalk through the cobbler command line
 * PXE features in more depth
   * PXE boot loop prevention and all about BIOS order
 * Virt features in more depth
 * cobbler power management (integration in a future release?)
 * cobbler dhcp/dns management
 * cobbler replicate and it's use in Spacewalk context
 * other cobbler features you might find interesting


