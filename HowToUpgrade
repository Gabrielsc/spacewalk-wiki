= Spacewalk Upgrade Instructions =

Spacewalk upgrade from version 0.2 to 0.3 involves several basic steps:
  1.  Configuration files and spacewalk database backup
  2.  Package upgrade
  3.  Schema upgrade
  4.  Activate spacewalk services
  5.  Restart Spacewalk

----


=  Database and configuration backup  =


  *  For existing configuration files, create a backup of everything under /etc/sysconfig/rhn/ and /etc/rhn/
  *  For instructions on how to create a backup of your existing spacewalk database consult either Oracle documentation or contact your DBA


= Package upgrade =

Setup your yum configuration to point to spacewalk 0.3 repo:

{{{
[spacewalk]
name=Spacewalk
baseurl=http://spacewalk.redhat.com/yum/0.3/rhel/5Server/$basearch/
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=1
}}}

Stop your spacewalk server. To accomplish this, execute following command as root:

{{{
# service rhn-satellite stop
}}}

Perform package upgrade using yum:

{{{
# yum upgrade
}}}


=  Schema upgrade  =

Make sure your spacewalk server is down:

{{{
# service rhn-satellite status
}}}

Make sure your oracle server is running. For oracle-xe that would be:

{{{
# service oracle-xe status
}}}

Run spacewalk-schema-upgrade script to upgrade database schema:

{{{
# /usr/bin/spacewalk-schema-upgrade
}}}


Log files from schema upgrade are being put into /var/log/spacewalk/schema-upgrade


=  Activate Spacewalk services  =

With release of 0.3 spacewalk services (rhn-search, satellite-httpd, taskomatic, ...) are no longer started from /etc/init.d/rhn-satellite,
every service has its own init.d script with chkconfig entries.

When doing a new Spacewalk 0.3 installation, all the services are being activated by spacewalk-setup. When upgrading existing Spacewalk 0.2
installation, you have to activate all these services manually:

{{{
# for service in jabberd osa-dispatcher taskomatic tomcat5 satellite-httpd Monitoring MonitoringScout rhn-search; do
    if [ -e "/etc/init.d/$service" ]; then
        /sbin/chkconfig --level 345 $service on
    fi
done
}}}


=  Restart spacewalk  =

If all of the above steps completed successfully, you can start your upgraded spacewalk. With Spacewalk 0.3 rhn-satellite init script
was decommissioned and all spacewalk services are being started individually. If you need to restart your spacewalk using one command,
use /sbin/rhn-satellite script.

{{{
# /sbin/rhn-satellite start
}}}


----

What's bellow are additional steps that were required for Spacewalk 0.1 to Spacewalk 0.2 upgrades. These steps are no longer required for
Spacewalk 0.2 to Spacewalk 0.3 upgrades and can be safely ignored.

=  Package paths upgrade =

Spacewalk ver. 0.2 introduced new layout of /var/satellite directory (change coming with multiple distribution support). To migrate
existing packages into new locations, use update-packages script (spacewalk-backend-satellite-tools) with a valid database connection string.

{{{
# /usr/bin/update-packages --db=spacewalk/spacewalk@xe
}}}


=  Update configuration  =


If you're upgrading Spacewalk 0.1 to version 0.2, add the following line into /etc/rhn/rhn.conf and /etc/rhn/default/rhn_web.conf:


{{{
web.product_name = Spacewalk
}}}