= How to use software crash reporting in Spacewalk =

== Overview ==

Spacewalk 1.9 extended on the software crash reporting functionality originally introduced in Spacewalk 1.8.

If you're using / have installed '''abrt''' ([https://fedorahosted.org/abrt/]) on your systems registered to Spacewalk, you may take advantage
of the software crash functionality provided by Spacewalk.

This functionality allows:

* your clients to automatically report software crashes captured by abrt directly to the Spacewalk server
* you to process the captured crashes in a centralized fasion: WEB UI & API for manipulation with the crashes

== Quick start ==

To use the software crash reporting functionality:

1. Install '''spacewalk-abrt''' package on your client system(s). This package will install '''abrt''' as its dependency. Note: neither abrt nor spacewalk-abrt are available for RHEL-5 / CentOS-5.
2. In your webui, navigate to:

{{{
    Systems -> | desired system | -> Software -> Software Crashes
}}}

to see the list of software crashes that occurred on the registered system. Click on the particular crash to see the crash details and crash files captured for this crash report.

3. Use the following API calls to manipulate with the reported software crashes:

{{{
system.crash.getLastReportDate()
system.crash.getUniqueCrashCount()
system.crash.getTotalCrashCount()
system.crash.listSystemCrashes()
system.crash.listSystemCrashFiles()
system.crash.deleteCrash()
system.crash.getCrashFileUrl()
system.crash.getCrashFile()
}}}

Consult the API documentation for further details.

4. With every software crash, your systems will upload files captured by abrt during the crash to your Spacewalk server. Since these files may have arbitrary length, you can set up an upload size limit for a single crash file. This is an organization wide settings and can be changed in webui:
{{{
Admin -> | your organization | -> Configuration
}}}
or with the following API calls:
{{{
org.getCrashFileSizeLimit()
org.setCrashFileSizeLimit()
}}}

== Usage details ==

The spacewalk-abrt package has two important components:
1. configuration file for abrt: /etc/libreport/events.d/spacewalk.conf
2. spacewalk-abrt utility: /usr/bin/spacewalk-abrt

spacewalk-abrt package contains the following configuration file:

{{{
/etc/libreport/events.d/spacewalk.conf
}}}

This configuration file instructs abrt daemon to use /usr/bin/spacewalk-abrt utility to automatically report every new crash that occurs on the system to your Spacewalk server. This is done in a fully automated fashion and ordinarilly does not require any human intervention.

Should you ever need to report a crash manually, use the spacewalk-abrt utility, executed from your client system:
{{{
# spacewalk-abrt --help
Usage: spacewalk-abrt [options]
  Commands:
    Specify one of the commands below

    --report=REPORT     Upload content of the specified problem directory
    --update-count=UPDATE_COUNT
                        Update crash count for the specified problem directory
    --sync              Synchronize missing problem directories
}}}

Use --report option to report a single crash:
{{{
# abrt-cli list
@0
Directory:      /var/tmp/abrt/ccpp-2013-02-28-15:48:50-8820
count:          2
executable:     /usr/bin/python2.7
package:        python-2.7.3-13.fc16
time:           Thu 28 Feb 2013 03:48:50 PM CET
uid:            0

@1
Directory:      /var/tmp/abrt/oops-2013-02-27-14:16:03-8107-1
count:          3
package:        kernel
time:           Wed 27 Feb 2013 02:16:03 PM CET

@2
Directory:      /var/tmp/abrt/ccpp-2013-02-13-14:44:49-10924
count:          20
executable:     /usr/bin/sleep
package:        coreutils-8.17-7.fc16
time:           Wed 13 Feb 2013 02:44:49 PM CET
uid:            0

@3
Directory:      /var/tmp/abrt/libreport-2012-09-26-13:55:57-21857
executable:     /sbin/firstboot
package:        firstboot-18.3-1.fc16.x86_64
time:           Wed 26 Sep 2012 07:55:57 PM CEST
uid:            0
# spacewalk-abrt --report /var/tmp/abrt/ccpp-2013-02-28-15:48:50-8820
}}}

Use --sync option to report all crashes that occurred on your system:
{{{
# spacewalk-abrt --sync
}}}


== Crash files ==

The crash files captured by abrt will be uploaded to your Spacewalk server for every crash report. These files can be downloaded from webui or via API. On your Spacewalk server, these crash files will be physically stored
on the file system under: $(spacewalk-cfg-get mount_point)/systems/$org_id/$system_id/crases/$crash_name/