= Oracle 10g Express Edition Setup =
== Limitations ==
 * 1GB memory (max)
 * 4GB disk space (max)
 * one database (max)
 * Oracle does not like SELinux.  Therefore SELinux should, unfortunately, be disabled.

== Installation ==
If you do not have an Oracle Database, you can [http://www.oracle.com/technology/software/products/database/xe/htdocs/102xelinsoft.html download Oracle XE].

You may need an account to download the rpms. Seems like a crap shoot to me. Download "Oracle Database 10g Express Edition ('''Universal''')", i.e. Multi-byte Unicode/UTF-8 database not "Western European" Single-byte LATIN1 database.

 * oracle-xe-univ-10.2.0.1-1.0.i386.rpm

You will also need a client. For this you should download the Oracle Instant Client: [http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxsoft.html i386 client] or [http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxx86_64soft.html x86_64]. Do '''NOT''' use oracle-xe-client. Download all four (4) of the
following. For now, stick with the 10.2.0.4 version.

 * oracle-instantclient-basic-10.2.0.4-1.i386.rpm
 * oracle-instantclient-jdbc-10.2.0.4-1.i386.rpm
 * oracle-instantclient-devel-10.2.0.4-1.i386.rpm
 * oracle-instantclient-sqlplus*.rpm 


=== Letting yum resolve deps ===
nogpgcheck is required because the oracle rpms are not signed.
 * sudo yum install --nogpgcheck oracle-xe-univ-10.2.0.1-1.0.i386.rpm oracle-instantclient-basic*.rpm oracle-instantclient-jdbc*.rpm oracle-instantclient-devel*.rpm oracle-instantclient-sqlplus*.rpm

=== manually ===

 * sudo yum install libaio.i386
 * sudo rpm -Uvh oracle-xe-univ-10.2.0.1-1.0.i386.rpm oracle-instantclient-basic-10.2.0.4-1.i386.rpm oracle-instantclient-devel-10.2.0.4-1.i386.rpm oracle-instantclient-jdbc-10.2.0.4-1.i386.rpm oracle-instantclient-sqlplus*.rpm

'''NOTE:''' Don't forget to have glibc.i686 installed on an x86_64 system. It will not be pulled in automagically!!!
 * sudo yum install glibc.i686

== Server Setup ==
Configure the Oracle XE database

  * Ensure your hostname is in /etc/hosts prior to running "oracle-xe configure"

{{{
 sudo /etc/init.d/oracle-xe configure
}}}


Here are some sane values:
{{{
 HTTP port: 9000 (8080 is tomcat)
 listener port: 1521
 password:<password> for SYS/SYSTEM
 have oracle start at boot: y
}}}

'''NOTE:''' if you messed up these entries, you '''WILL''' have to uninstall and reinstall.

 * rpm -e oracle-xe-client oracle-xe-univ
 * OracleXeSetup#Installation


Login to the webui and configure a user (see OracleXeWebAccessPrep):

 * browse to http://127.0.0.1:9000/apex
 * login: sys
 * click Administration
 * click Database Users
 * click "Create >" button
 * username: '''spacewalk'''
 * password: '''spacewalk'''
 * Confirm password: '''spacewalk'''
 * Give spacewalk all system privileges (check All and add DBA role) 
 * click Create button

That's it, proceed with [OracleXeSetup#setupclient client setup]. 
 * If you weren't able to connect to http://127.0.0.1:9000/apex, check /usr/lib/oracle/xe/app/oracle/admin/XE/bdump/alert_XE.log for errors.     
 * This is an example error when oracle isn't able to resolve your hostname, [http://virag.sharma.googlepages.com/oraclexemadeeasy#_Getting_ORA-600_error more info] 
{{{ 
  Errors in file /usr/lib/oracle/xe/app/oracle/admin/XE/udump/xe_ora_4382.trc: 
  ORA-00600: internal error code, arguments: [keltnfy-ldmInit], [46], [1], [], [], [], [], [] 
  USER: terminating instance due to error 600 
}}} 
 
== setup client == 
You need to put the Oracle clients on your path and configure ORACLE_HOME. 
{{{ 
 export PATH=$PATH:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/ 
 export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server 
}}} 
 * The best way of doing this is below, remember to logout and back in after setting the link 
   so your env is updated. 
{{{ 
  cd /etc/profile.d 
  ln -s /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh 
}}} 
An alternative to logging out and still obtaining the correct environment is: 
{{{ 
. /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh 
}}} 
You also need to configure the tns names entry for your database. Place the following into {{{/etc/tnsnames.ora}}}: 
{{{ 
XE = 
    (DESCRIPTION = 
       (ADDRESS_LIST = 
          (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)) 
       ) 
       (CONNECT_DATA = 
          (SERVICE_NAME = xe) 
       ) 
    ) 
}}} 
 
Test your connection with sqlplus: 
{{{ 
sqlplus spacewalk/spacewalk@xe 
}}} 
 
 
If '''spacewalk''' user was properly setup you should see a '''Connected to:''' message: 
 
{{{ 
SQL*Plus: Release 10.2.0.1.0 - Production on Sat May 17 10:52:56 2008 
 
Copyright (c) 1982, 2005, Oracle.  All rights reserved. 
 
 
Connected to: 
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production 
 
SQL> 
}}} 
 
 '''NOTE:''' you might want to install 'rlwrap' to make your sqlplus more usable. {{{rlwrap}}} will retain 
 a [http://en.wikipedia.org/wiki/Curses_(programming_library) 'curses'] like behavior with sqlplus such as maintaining sql call history, etc. 
 {{{yum install rlwrap}}} 
 you can then do  
 {{{ 
 rlwrap sqlplus spacewalk/spacewalk@xe 
 }}}  
 
== increase max process == 
 
Oracle XE is initially configured to grant 40 connections to its database.  Spacewalk needs more than this default configuration.  We recommend increase this setting to 400: 
 
{{{ 
# sqlplus spacewalk/spacewalk@xe 
 
.. 
 
SQL> alter system set processes = 400 scope=spfile; 
 
System altered. 
 
SQL> commit; 
 
Commit complete. 
 
SQL> quit 
 
# /sbin/service oracle-xe restart 
}}} 
 
== setup development schema (optional) == 
 
This is only for use if running a development environment or development version of spacewalk.  See [https://fedorahosted.org/spacewalk/wiki/DevelopmentWorkstationSetup Dev Station setup] for this info.

 
= Known Issues =

 * Users are experiencing an Internal Server Error (500) when viewing Systems -> Pick a System -> Software -> Packages -> Install New Package (URL: https://spacewalk.example.com/rhn/systems/details/packages/InstallPackages.do?sid=**********) or when running rhnreg_ks to register a client.
 
This is an Oracle XE bug. Details are noted in BZ: https://bugzilla.redhat.com/show_bug.cgi?id=453176. If you are experiencing this use workaround: 
{{{ 
# sqlplus spacewalk/spacewalk@xe 
 
SQL> alter system set "_optimizer_filter_pred_pullup"=false scope=spfile; 
 
System altered. 
 
SQL> alter system set "_optimizer_cost_based_transformation"=off scope=spfile; 
 
System altered. 
 
SQL> quit 
 
# /sbin/service oracle-xe restart 
}}}

 * Need these 2 environment variables:

{{{
# export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/
# export PATH=$PATH:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/
}}}


 * You may need to adjust selinux (or disable it) if you encounter this error:

{{{
Could not connect to the database.  Your connection information may be incorrect.  Error: install_driver(Oracle) failed: Can't load '/usr/lib/perl5/site_perl/5.8.8/i386-linux-thread-multi/auto/DBD/Oracle/Oracle.so' for module DBD::Oracle: /usr/lib/oracle/10.2.0/client/lib/libnnz10.so: cannot restore segment prot after reloc: Permission denied at /usr/lib/perl5/5.8.8/i386-linux-thread-multi/DynaLoader.pm line 230, <STDIN> line 6.
 at (eval 784) line 3
Compilation failed in require at (eval 784) line 3, <STDIN> line 6.
Perhaps a required shared library or dll isn't installed where expected
 at /usr/bin/spacewalk-setup line 1504
}}}

 * The following commands can be used to give Oracle proper selinux permissions: (NOTE: CURRENTLY UNTESTED)

{{{
semanage fcontext -a -t textrel_shlib_t '/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/*'
restorecon -R /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib
}}}

 * can't find {{{libclntsh.so.10.1}}} on x86_64 installation, need to modify {{{LD_LIBRARY_PATH}}} to point to all versions of the {{{libclntsh.so.10.1}}} file:

{{{
Could not connect to the database.  Your connection information may be
incorrect.  Error: install_driver(Oracle) failed: Can't load
'/usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi/auto/DBD/Oracle/Oracle.so'
for module DBD::Oracle: libclntsh.so.10.1: wrong ELF class: ELFCLASS32 at
/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi/DynaLoader.pm line 230, <STDIN>
line 6.
 at (eval 784) line 3
 Compilation failed in require at (eval 784) line 3, <STDIN> line 6.
 Perhaps a required shared library or dll isn't installed where expected
  at /usr/bin/spacewalk-setup line 1492
}}}
{{{
[root@test12-64 ~]# locate libclntsh.so.10.1
/usr/lib/oracle/10.2.0.4/client64/lib/libclntsh.so.10.1
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1
}}}
edit the file in {{{/etc/ld.so.conf.d}}} created earlier and run {{{ldconfig -v}}} to enable the changes.
 
 
== misc links == 
[http://www.oracle.com/technology/software/products/database/xe/files/install.102/b25144/toc.htm Installation Guide] 

[http://www.davidpashley.com/articles/oracle-install.html Installing Oracle XE on Debian] 

Continue installing Spacewalk: HowToInstall#Installation 
