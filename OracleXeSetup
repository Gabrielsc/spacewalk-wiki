
= Oracle 10g Express Edition Setup =

== Limitations ==

 * will use maximum of 1GB RAM
 * 4GB user data (max)
 * may be installed on a multiple CPU server, but may only be executed on one processor in any server
 * one database (max)

The full license agreement is available via the download page linked below.

== Download ==

=== Server ===

You can download Oracle 10g Express Edition (XE) Server from Oracle's [http://www.oracle.com/technology/software/products/database/xe/htdocs/102xelinsoft.html Oracle Database 10g Express Edition Downloads for Linux x86] page. You will need an Oracle OTN account to download the rpms and you will need to accept the license agreements. Download the "Oracle Database 10g Express Edition ('''Universal''')"

 * oracle-xe-univ-10.2.0.1-1.0.i386.rpm

which is the Multi-byte Unicode/UTF-8 database, not the "Western European" Single-byte LATIN1 database.

=== Client ===

You will also need the Oracle Instant Client: [http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxsoft.html i386] or [http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxx86_64soft.html x86_64] version. Download the following two rpms (where ARCH is either i386 or x86_64):

 * oracle-instantclient-basic-10.2.0.4-1.ARCH.rpm
 * oracle-instantclient-sqlplus-10.2.0.4-1.ARCH.rpm 

For now, stick with the 10.2.0.4 version. Do '''NOT''' use oracle-xe-client.

== Before installing Oracle XE ==

If you want to run with SELinux enabled, run the following two commands to create the group and user for the oracle-xe-univ package, prior to installing said package:

{{{
# /usr/sbin/groupadd -r dba
# /usr/sbin/useradd -r -M -g dba -d /usr/lib/oracle/xe -s /bin/bash oracle
}}}

This is needed to give the oracle user uid below 500. See [https://fedorahosted.org/spacewalk/wiki/Features/SELinux Features/SELinux] for more details and limitations of SELinux support.

== Install ==

{{{
# yum install bc libaio.i386 glibc.i686
# yum localinstall --nogpgcheck oracle-xe-univ-10.2.0.1-1.0.i386.rpm oracle-instantclient-basic*.rpm oracle-instantclient-sqlplus*.rpm
}}}

  * bc is a dependency of oracle-xe which is not resolved automatically causing the oracle install to be incomplete!
  * nogpgcheck is required because the Oracle RPMs are not signed.
  * '''NOTE:''' Don't forget to have glibc.i686 installed on an x86_64 system. It will not be pulled in automagically!

=== Alternative: manual install ===

{{{
# yum install bc libaio.i386 glibc.i686
# rpm -Uvh oracle-xe-univ-10.2.0.1-1.0.i386.rpm oracle-instantclient-basic-10.2.0.4-1.*.rpm oracle-instantclient-sqlplus*.rpm
}}}

== Install SELinux Policy ==

If you are running with SELinux enabled then install the following packages from the Spacewalk repo before running {{{oracle-xe configure}}}:

{{{
# yum install oracle-xe-selinux oracle-instantclient-selinux
}}}

This will likely pull in {{{compat-libstdc++-33}}}, {{{oracle-lib-compat}}}, and {{{oracle-nofcontext-selinux}}} as well.

== Server Setup ==

Ensure your hostname is in /etc/hosts prior to conguring the Oracle XE database.

Configure the Oracle XE database by running

{{{
# /etc/init.d/oracle-xe configure
}}}

Here are some sane values for the configure:

{{{
 HTTP port for Oracle Application Express: 9000
 Database listener port: 1521
 Password for SYS/SYSTEM: <password>
 Start at boot: y
}}}

Note that the port 8080 is used by tomcat so you cannot accept the default for the Oracle Application Express. Also, the SELinux policy module assumes that the Application Express port is 9000, if you want different value, you need to define it for {{{oracle_port_t}}} via {{{semanage}}}.

If you messed up these entries, you '''WILL''' have to uninstall and reinstall.

 * rpm -e oracle-xe-univ
 * OracleXeSetup#Install

== Setup tnsnames.ora ==

Place the following into {{{/etc/tnsnames.ora}}}:

{{{ 
XE = 
    (DESCRIPTION = 
       (ADDRESS_LIST = 
          (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)) 
       ) 
       (CONNECT_DATA = 
          (SERVICE_NAME = xe) 
       ) 
    ) 
}}} 

== Client setup on 64bit platform == 

Users on x86_64 will need to add the following line(s) to the file {{{/etc/ld.so.conf.d/oracle-xe.conf}}}
{{{
/usr/lib/oracle/10.2.0.4/client64/lib
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib
}}}
Run {{{ldconfig -v}}} to enable these changes on your system.

== Test your connection with sqlplus ==

Run

{{{
sqlplus 'sys/<password>@xe as sysdba'
}}} 
 
You should see something like
 
{{{
SQL*Plus: Release 10.2.0.4.0 - Production on Thu Mar 26 12:04:30 2009

Copyright (c) 1982, 2007, Oracle.  All Rights Reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL> 
}}} 

== Create the spacewalk database user ==

{{{
# sqlplus 'sys/<password>@xe as sysdba'
SQL> create user spacewalk identified by spacewalk default tablespace users;
SQL> grant dba to spacewalk;
SQL> quit
}}}

Test that

{{{
# sqlplus spacewalk/spacewalk@xe
}}}

works.

== Additional Oracle configuration ==

Oracle XE is initially configured to grant 40 connections to its database.  Spacewalk needs more than this default configuration.  We recommend increasing this setting to 400. 

Oracle XE has a bug that causes an Internal Server Error (500) in Spacewalk when viewing Systems -> Pick a System -> Software -> Packages -> Install New Package
(URL: https://spacewalk.example.com/rhn/systems/details/packages/InstallPackages.do?sid=**********) or when running
{{{rhnreg_ks}}} to register a client.

In order to avoid these two problems we need to increase the max processes in Oracle and to 
 
{{{ 
# sqlplus spacewalk/spacewalk@xe 
SQL> alter system set processes = 400 scope=spfile; 
SQL> alter system set "_optimizer_filter_pred_pullup"=false scope=spfile; 
SQL> alter system set "_optimizer_cost_based_transformation"=off scope=spfile; 
SQL> quit  
# /sbin/service oracle-xe restart 
}}}

If you encounder 500s with messages like
{{{
DATABASE CONNECTION TO 'xe' LOST
}}}

and /usr/lib/oracle/xe/app/oracle/admin/XE/bdump/alert_XE.log having messages like
{{{
ORA-07445: exception encountered: core dump [08F93BDE] [SIGSEGV] [Address not mapped to object] [0x34979C] [] []
}}}

you might try to workaround it with
{{{ 
# sqlplus spacewalk/spacewalk@xe 
SQL>  alter system set query_rewrite_enabled=TRUE ;
SQL> quit
}}}

as suggested in http://stephensorablog.blogspot.com/2006/05/solution-to-dreaded-ora-07445-error.html

You might want to install 'rlwrap' to make your sqlplus more usable. {{{rlwrap}}} will retain 
a [http://en.wikipedia.org/wiki/Curses_(programming_library) 'curses'] like behavior with sqlplus such as maintaining sql call history, etc.

{{{
yum install rlwrap
}}}
 
You can then do  

{{{ 
rlwrap sqlplus spacewalk/spacewalk@xe 
}}}  
 
== Setup development schema (optional) == 
 
This is only for use if running a development environment or development version of spacewalk.  See [https://fedorahosted.org/spacewalk/wiki/DevelopmentWorkstationSetup Dev Station setup] for this info.

 
== Known Issues ==

 * If you run with SELinux enabled, you should also install oracle-xe-selinux and oracle-instantclient-selinux packages, or you might experience errors like:

{{{
Could not connect to the database.  Your connection information may be incorrect.  Error: install_driver(Oracle) failed:
Can't load '/usr/lib/perl5/site_perl/5.8.8/i386-linux-thread-multi/auto/DBD/Oracle/Oracle.so' for module DBD::Oracle:
/usr/lib/oracle/10.2.0/client/lib/libnnz10.so: cannot restore segment prot after reloc: Permission denied at
/usr/lib/perl5/5.8.8/i386-linux-thread-multi/DynaLoader.pm line 230, <STDIN> line 6.
 at (eval 784) line 3
Compilation failed in require at (eval 784) line 3, <STDIN> line 6.
Perhaps a required shared library or dll isn't installed where expected
 at /usr/bin/spacewalk-setup line 1504
}}}
 

== Troubleshooting ==

If you get errors such as: 
{{{
   ORA-01654: unable to extend index SPACEWALK.RHN_PACKAGE_FILE_CID_PID_IDX by 5 in tablespace SPACEWALK
}}}

  or anything from Oracle complaing that it can't '''extend''' an index, a table, etc.. you should run:

{{{
  SQL> ALTER TABLESPACE system ADD DATAFILE '/usr/lib/oracle/xe/oradata/XE/system_02.dbf' size 200m;
  SQL> ALTER TABLESPACE users ADD DATAFILE '/usr/lib/oracle/xe/oradata/XE/users_02.dbf' size 200m;
  SQL> ALTER TABLESPACE undo ADD DATAFILE '/usr/lib/oracle/xe/oradata/XE/undo_02.dbf' size 200m;
}}}

Quit sqlplus and restart spacewalk and oracle-xe (may not require a restart)

== Misc links ==

[http://www.oracle.com/technology/software/products/database/xe/files/install.102/b25144/toc.htm Installation Guide] 

[http://www.davidpashley.com/articles/oracle-install.html Installing Oracle XE on Debian] 

Continue installing Spacewalk: HowToInstall#Installation 
