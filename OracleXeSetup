= Oracle 10g Express Edition Setup =
== Limitations ==
 * 1GB memory (max)
 * 4GB disk space (max)
 * one database (max)

== Installation ==
If you do not have an Oracle Database, you can [http://www.oracle.com/technology/software/products/database/xe/htdocs/102xelinsoft.html download Oracle XE].

You may need an account to download the rpms. Seems like a crap shoot to me. Download "Oracle Database 10g Express Edition ('''Universal''')", i.e. Multi-byte Unicode/UTF-8 database not "Western European" Single-byte LATIN1 database.

 * oracle-xe-univ-10.2.0.1-1.0.i386.rpm
 * oracle-xe-client-10.2.0.1-1.0.i386.rpm

You will also need a client. For this you should [http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxsoft.html download Oracle Instant Client]. Download all four (4) of the
following. For now, stick with the 10.2.0.4 version.

 * oracle-instantclient-basic-10.2.0.4-1.i386.rpm
 * oracle-instantclient-jdbc-10.2.0.4-1.i386.rpm
 * oracle-instantclient-devel-10.2.0.4-1.i386.rpm
 * oracle-instantclient-sqlplus*.rpm 


=== Letting yum resolve deps ===
nogpgcheck is required because the oracle rpms are not signed.
 * sudo yum install --nogpgcheck oracle-xe-univ-10.2.0-1.0.i386.rpm oracle-instantclient-basic-10.2.0.4-1.i386.rpm oracle-instantclient-jdbc-10.2.0.4-1.i386.rpm oracle-instantclient-devel-10.2.0.4-1.i386.rpm oralce-instantclient-sqlplus*.rpm

=== manually ===

 * sudo yum install libaio
 * sudo rpm -Uvh oracle-xe-univ-10.2.0-1.0.i386.rpm oracle-instantclient-basic-10.2.0.4-1.i386.rpm oracle-instantclient-devel-10.2.0.4-1.i386.rpm oracle-instantclient-jdbc-10.2.0.4-1.i386.rpm oracle-instantclient-sqlplus*.rpm


== setup server ==
Configure the Oracle XE database

  * Ensure your hostname is in /etc/hosts prior to running "oracle-xe configure"

{{{
 sudo /etc/init.d/oracle-xe configure
}}}


Here are some sane values:
{{{
 HTTP port: 9000 (8080 is tomcat)
 listener port: 1521
 password:<password> for SYS/SYSTEM
 have oracle start at boot: y
}}}

'''NOTE:''' if you messed up these entries, you WILL have to uninstall and reinstall.

 * rpm -e oracle-xe-client oracle-xe-univ
 * OracleXeSetup#Installation


Login to the webui and configure a user:

  '''NOTE:''' If you do not have X, so you can't use firefox or you are using ssh to go to this terminal, try running the following command:
  {{{ssh -L 9000:localhost:9000 -l root -N <oracle machine name>}}}. This should allow you to browse to localhost, proceed with   
  the rest of the instructions.

 * browse to http://127.0.0.1:9000/apex
 * login: sys
 * click Administration
 * click Database Users
 * click "Create >" button
 * username: '''spacewalk'''
 * password: '''spacewalk'''
 * Confirm password: '''spacewalk'''
 * Give spacewalk all system privileges (check All and add DBA role) 
 * click Create button
That's it, proceed with client setup.

 * If you weren't able to connect to http://127.0.0.1:9000/apex, check /usr/lib/oracle/xe/app/oracle/admin/XE/bdump/alert_XE.log for errors.    
 * This is an example error when oracle isn't able to resolve your hostname, [http://virag.sharma.googlepages.com/oraclexemadeeasy#_Getting_ORA-600_error more info]
{{{
  Errors in file /usr/lib/oracle/xe/app/oracle/admin/XE/udump/xe_ora_4382.trc:
  ORA-00600: internal error code, arguments: [keltnfy-ldmInit], [46], [1], [], [], [], [], []
  USER: terminating instance due to error 600
}}}

== setup client ==
You need to put the Oracle clients on your path and configure ORACLE_HOME.
{{{
 export PATH=$PATH:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/
 export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
}}}
 * The best way of doing this is below, remember to logout and back in after setting the link
   so your env is updated.
{{{
  cd /etc/profile.d
  ln -s /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
}}}
An alternative to logging out and still obtaining the correct environment is:
{{{
. /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
}}}
You also need to configure the tns names entry for your database. Place the following into {{{/etc/tnsnames.ora}}}:
{{{
XE =
    (DESCRIPTION =
       (ADDRESS_LIST =
          (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
       )
       (CONNECT_DATA =
          (SERVICE_NAME = xe)
       )
    )
}}}

Test your connection with sqlplus:
{{{
sqlplus spacewalk/spacewalk@xe
}}}


If '''spacewalk''' user was properly setup you should see a '''Connected to:''' message:

{{{
SQL*Plus: Release 10.2.0.1.0 - Production on Sat May 17 10:52:56 2008

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL>
}}}

 '''NOTE:''' you might want to install 'rlwrap' to make your sqlplus more usable. {{{rlwrap}}} will retain
 a [http://en.wikipedia.org/wiki/Curses_(programming_library) 'curses'] like behavior with sqlplus such as maintaining sql call history, etc.
 {{{yum install rlwrap}}}
 you can then do 
 {{{
 rlwrap sqlplus spacewalk/spacewalk@xe
 }}} 

== increase max process ==

Oracle XE is initially configured to grant 40 connections to its database.  Spacewalk needs more than this default configuration.  We recommend increase this setting to 400:

{{{
# sqlplus spacewalk/spacewalk@xe

..

SQL> alter system set processes = 400 scope=spfile;

System altered.

SQL> commit;

Commit complete.

SQL> quit

# /sbin/service oracle-xe restart
}}}

== setup schema (optional) ==

'''NOTE:''' this is '''NOT''' required if you plan on installing Spacewalk. Only needed for dev setup.

If you just want the Spacewalk database schema installed you can do the following:

{{{
 cd $GITDIR/schema
 make satellite-clean satellite-release TBS=USERS SQLUSER=spacewalk/spacewalk@xe
}}}

If you plan on installing Spacewalk and running the entire application you can skip this step.  The spacewalk-setup program will install the schema for you.

== misc links ==
[http://www.oracle.com/technology/software/products/database/xe/files/install.102/b25144/toc.htm Installation Guide]

[http://www.davidpashley.com/articles/oracle-install.html Installing Oracle XE on Debian]

Continue installing Spacewalk: HowToInstall#Installation