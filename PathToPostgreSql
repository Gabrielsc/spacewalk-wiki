Satellite today is Oracle only and unfortunately this reliance on Oracle runs very deep into the code. 

= Areas to Address =

== Installer ==

Probably one of the smaller and most manageable projects involved, but our installer Perl scripts currently only support Oracle databases. These would require some refactoring to push the Oracle specific setup out into it's own module and thus add support for other database backends. (even if initially, Oracle remains the only option)

== Schema ==

/etc/sysconfig/rhn/universe.satellite.sql (basically all the schema required to create the Satellite database) is ~2M in size. My understanding is that most of this will have to be adjusted for any other databases we wish to support, leading to the unplesant prospect of maintaining multiple copies of the schema creation SQL scripts.

== Queries ==

Reportedly we have some Oracle specific syntax in our many database queries. I suspect this is mostly in the datasource queries and not so much the hibernate queries. Some slight modifications to datasource code should allow us to use the same SQL for queries normally, but fork the query into two versions if necessary. (or we could work on removing the Oracle specific bits altogether)

== Stored Procedure ==

Satellite currently uses many stored procedures, which again will need to be completely ported to the Postgresql syntax. One option we may wish to consider as part of this is to push any of these stored procedures out into application code in the Java layer if it makes sense to do so. If we can reduce the usage of stored procedures to only extremely performance intensive operations (whenever they arise) we'll lighten the workload involved in maintaining multiple database backends.

= Plan of Attack =

  1. Create Satellite tables in Postgresql.
    * Port Oracle .sql scripts in a new location in git, not yet included in Satellite builds.
    * Must be careful not to miss any ongoing changes to schema in the primary Oracle scripts.
    * Looks like most of this can be migrated from an existing Oracle db using ora2pg. Resulting output needs only minor edits to function properly.
  1. Document steps to configure Satellite to run against Postgresql.
  1. Start work on porting stored procedures.
    * Should these be pushed into application code instead when possible?
  1. Fix failing queries.
    * Probably will involve datasource modifications to support multiple versions of queries depending on the database backend.

= Links =

  * [http://www.pgadmin.org/ pgAdmin]: Looks like an exceptional GUI tool for Postgresql management.
  * http://www.pgadmin.org/docs/1.4/pg/plpgsql-porting.html: Some notes on migrating Oracle PL/SQL to PL/pgSQL.
  * [http://freshmeat.net/projects/ora2pg/ ora2pg]: Migration tool.

= Some Stats =

Most expensive stored procedures to port from Oracle to Post Gres

|| Package Name || Procedure Name || Number of lines||
|| RPM || rpmstrcmp ||132 ||
|| RHN_ENTITLEMENTS || modify_org_service ||127 ||
|| RHN_CHANNEL || subscribe_server ||120 ||
|| RHN_ORG || delete_user ||119 ||
|| RHN_ENTITLEMENTS || repoll_virt_guest_entitlements ||109 ||
|| RHN_CHANNEL || unsubscribe_server ||100 ||
|| RHN_SERVER || insert_into_servergroup ||95 ||
|| RHN_SERVER || snapshot_server ||89 ||
|| RHN_ENTITLEMENTS || assign_system_entitlement ||85 ||
|| RHN_ENTITLEMENTS || prune_group ||81 ||
|| RHN_SERVER || delete_from_servergroup ||78 ||
|| RHN_CHANNEL || channel_priority ||77 ||
|| RHN_ENTITLEMENTS || remove_server_entitlement ||73 ||
|| RHN_USER || find_mailable_address ||71 ||
|| RHN_CONFIG || delete_revision ||70 ||
|| RHN_ENTITLEMENTS || set_family_count ||63 ||
|| RHN_SERVER || remove_action ||62 ||
|| RHN_ENTITLEMENTS || assign_channel_entitlement ||62 ||
|| RHN_ENTITLEMENTS || set_group_count ||58 ||
|| RHN_ENTITLEMENTS || prune_family ||56 ||
|| RHN_ENTITLEMENTS || entitle_server ||55 ||
|| RHN_ENTITLEMENTS || can_entitle_server ||55 ||
|| RHN_CONFIG_CHANNEL || get_user_chan_access ||53 ||
|| RHN_CONFIG_CHANNEL || action_diff_revision_status ||50 ||
|| RHN_ENTITLEMENTS || prune_everything ||50 ||
|| RHN_CHANNEL || bulk_server_basechange_from ||46 ||
|| RHN_CHANNEL || available_family_subscriptions ||46 ||
|| RHN_ORG || delete_org ||45 ||
|| RHN_CHANNEL || user_role_check_debug ||44 ||
|| RHN_ENTITLEMENTS || activate_system_entitlement ||41 ||
|| RHN_ENTITLEMENTS || unentitle_server ||41 ||
|| RHN_CHANNEL || base_channel_rel_archid ||40 ||
|| RHN_ENTITLEMENTS || activate_channel_entitlement ||40 ||
|| RHN_CHANNEL || delete_server_channels ||38 ||
|| RHN_SERVER || bulk_snapshot ||37 ||
|| RHN_ENTITLEMENTS || subscribe_newest_servers ||36 ||
|| RHN_ENTITLEMENTS || entitle_last_modified_servers ||36 ||
|| RHN_ENTITLEMENTS || remove_org_entitlements ||35 ||
|| RHN_SERVER || bulk_snapshot_tag ||31 ||
|| RPM || vercmp ||30 ||
|| RHN_CONFIG || insert_revision ||30 ||
|| RHN_ENTITLEMENTS || find_compatible_sg ||29 ||
|| RHN_CHANNEL || can_server_consume_virt_channl ||29 ||
|| RHN_CHANNEL || entitle_customer ||28 ||
|| RHN_CHANNEL || set_family_maxmembers ||27 ||
|| RHN_SERVER || check_user_access ||27 ||
|| RHN_CHANNEL || update_channel ||27 ||
|| RHN_ENTITLEMENTS || get_server_entitlement ||26 ||
|| RHN_SERVER || set_custom_value ||26 ||
|| RHN_ENTITLEMENTS || entitlement_grants_service ||26 ||
|| RHN_SERVER || insert_set_into_servergroup ||26 ||
|| RHN_SERVER || insert_into_servergroup_maybe ||25 ||
|| RHN_CONFIG || insert_channel ||25 ||
|| RHN_SERVER || can_server_consume_virt_slot ||25 ||
|| RHN_CHANNEL || bulk_guess_server_base_from ||25 ||
|| RHN_SERVER || tag_delete ||24 ||
|| RHN_QUOTA || recompute_org_quota_used ||24 ||
|| RHN_EXCEPTION || raise_exception ||24 ||
|| RHN_SERVER || delete_set_from_servergroup ||23 ||
|| RHN_CACHE || update_perms_for_server_group ||23 ||
|| RHN_CACHE || update_perms_for_user ||23 ||
|| RHN_CHANNEL || channel_family_current_members ||23 ||
|| RHN_ENTITLEMENTS || can_switch_base ||23 ||
|| RHN_USER || remove_from_usergroup ||23 ||
|| RHN_USER || add_servergroup_perm ||21 ||
|| RHN_SERVER || get_ip_address ||21 ||
|| RHN_CONFIG || insert_file ||20 ||
|| RHN_CHANNEL || bulk_guess_server_base ||20 ||
|| RHN_CHANNEL || get_org_access ||20 ||
|| RHN_CHANNEL || base_channel_for_release_arch ||20 ||
|| RHN_QUOTA || set_org_quota_total ||20 ||
|| RHN_ENTITLEMENTS || lookup_entitlement_group ||19 ||
|| RHN_CONFIG || delete_file ||19 ||
|| RHN_ENTITLEMENTS || create_entitlement_group ||19 ||
|| RHN_SERVER || bulk_set_custom_value ||19 ||
|| RHN_CHANNEL || direct_user_role_check ||19 ||
|| RHN_CHANNEL || org_channel_setting ||19 ||
|| RHN_USER || check_role_implied ||18 ||
|| RHN_USER || check_role ||18 ||
|| RHN_USER || remove_servergroup_perm ||18 ||
|| RHN_CONFIG_CHANNEL || get_user_revision_access ||18 ||
|| RHN_USER || add_to_usergroup ||18 ||
|| RHN_CHANNEL || guess_server_base ||17 ||
|| RHN_DATE_MANIP || get_reporting_period_end ||17 ||
|| RHN_CHANNEL || refresh_newest_package ||17 ||
|| RHN_CHANNEL || license_consent ||17 ||
|| RHN_DATE_MANIP || get_reporting_period_start ||17 ||
|| RHN_CHANNEL || get_license_path ||16 ||
|| RHN_CHANNEL || clear_subscriptions ||16 ||
|| RHN_CONFIG_CHANNEL || get_user_file_access ||16 ||
|| RHN_PACKAGE || channel_occupancy_string ||16 ||
|| RHN_SERVER || system_service_level ||16 ||
|| RHN_PACKAGE || canonical_name ||15 ||
|| RHN_EXCEPTION || lookup_exception ||15 ||
|| RHN_SERVER || can_change_base_channel ||15 ||
|| RHN_CHANNEL || user_role_check ||15 ||
|| RHN_QUOTA || get_org_for_config_content ||14 ||
|| RHN_CHANNEL || family_for_channel ||14 ||
|| RHN_CHANNEL || normalize_server_arch ||14 ||
|| RHN_CHANNEL || get_cfam_org_access ||14 ||
|| RHN_SERVER || delete_from_org_servergroups ||14 ||
|| RHN_CONFIG || get_latest_revision ||13 ||
|| RHN_USER || add_users_to_usergroups ||13 ||
|| RHN_USER || remove_users_from_servergroups ||13 ||
|| RHN_EXCEPTION || raise_exception_val ||12 ||
|| RHN_CHANNEL || available_chan_subscriptions ||12 ||
|| RHN_CONFIG || delete_channel ||12 ||
|| RHN_SERVER || clear_servergroup ||11 ||
|| RHN_CHANNEL || unsubscribe_server_from_family ||11 ||
|| RHN_CHANNEL || update_channels_by_package ||11 ||
|| RHN_CHANNEL || update_channels_by_errata ||11 ||
|| RPM || isalphanum ||11 ||
|| RHN_CHANNEL || bulk_server_base_change ||11 ||
|| RPM || isalpha ||10 ||
|| RHN_SERVER || tag_snapshot ||10 ||
|| RHN_BEL || lookup_email_state ||10 ||
|| RHN_BEL || is_org_paid ||10 ||
|| RHN_ORG || find_server_group_by_type ||10 ||
|| RHN_CACHE || update_perms_for_server ||10 ||
|| RHN_CHANNEL || update_family_counts ||10 ||
|| RHN_CHANNEL || get_org_id ||9 ||
|| RHN_USER || get_org_id ||9 ||
|| RPM || isdigit ||9 ||
|| RHN_CHANNEL || loose_user_role_check ||8 ||
|| RPM || vercmpResetCounter ||8 ||
|| RHN_QUOTA || update_org_quota ||7 ||
|| RHN_CHANNEL || bulk_unsubscribe_server ||7 ||
|| RHN_CHANNEL || bulk_subscribe_server ||7 ||
|| RHN_CONFIG || prune_org_configs ||6 ||
|| RHN_ENTITLEMENTS || unset_customer_monitoring ||5 ||
|| RHN_ENTITLEMENTS || unset_customer_enterprise ||5 ||
|| RHN_ENTITLEMENTS || set_customer_nonlinux ||5 ||
|| RHN_ENTITLEMENTS || set_customer_provisioning ||5 ||
|| RHN_ENTITLEMENTS || unset_customer_nonlinux ||5 ||
|| RPM || vercmpCounter ||5 ||
|| RHN_ENTITLEMENTS || set_customer_monitoring ||5 ||
|| RHN_ENTITLEMENTS || set_customer_enterprise ||5 ||
|| RHN_ENTITLEMENTS || unset_customer_provisioning ||5 ||
