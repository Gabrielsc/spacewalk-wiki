
= Spacewalk with PostgreSQL backend =

Historically, RHN Satellite and thus Spacewalk servers required Oracle RDBMS as database backend. In an attempt to make the whole Spacewalk project use open source software, we'd like to add support for PostgreSQL as database backend. For Spacewalk 0.6, quite a lot of work went into Spacewalk schema changes to make the schema PostgreSQL compatible. Unfortunately, little effort was made to make those changes and the whole PostgreSQL support sustainable.

This is a page describing the status of the PostgreSQL support as of July 2010, before Spacewalk 1.1 release.

== Parts of the problem (and solution) ==

=== What bits to use ===

The setup as decribed below will only work on Fedora 12 for now, with nightly repo. RHEL 5 has PostgreSQL which is too old, and Fedora 13 nightly repo is not complete yet.

{{{
cat > /etc/yum.repos.d/spacewalk.repo << 'EOF'
[spacewalk]
name=Spacewalk
# Fedora 12
baseurl=http://koji.spacewalkproject.org/spacewalk/split/spacewalk-f12/server/spacewalk-f12-1.1/$basearch/os
gpgkey=http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk
enabled=1
gpgcheck=0
EOF
}}}

=== Get the PostgreSQL server running ===

Follow [wiki:PostgreSQLServerSetup].

=== Install the spacewalk-postgresql and configure it ===

When installing Spacewalk, you install either {{{spacewalk-oracle}}} or {{{spacewalk-postgresql}}} which should give you correct backend and dependencies. To use PostgreSQL backend, install {{{spacewalk-postgresql}}}.

Then, when you run {{{spacewalk-setup}}}, you'll be asked for connection information:

{{{
# spacewalk-setup --disconnected
** Database: Setting up database connection for PostgreSQL backend.
Hostname (leave empty for local)? 
Database? spaceschema
Username? spaceuser
Password? 
** Database: Populating database.
}}}

==== TODO ====

We should Require {{{postgresql}}} in {{{spacewalk-postgresql}}} to get {{{psql}}} installed even if the PostgreSQL server is on another box. This setup needs to be verified anyway -- I only tried local setup.

=== Database schema ===

When Spacewalk is installed and {{{spacewalk-setup}}} run for the first time, database is populated with necessary database objects. For PostgreSQL support, the schema is compiled from files in the {{{schema/spacewalk/common/}}} and {{{schema/spacewalk/postgres/}}} directories in the Spacewalk git repo.