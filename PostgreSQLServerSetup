
= Setup of the PostgreSQL database =

You should have PostgreSQL server running somewhere. Let's assume you will run the server on the same machine as Spacewalk itself:

{{{
yum install -y 'postgresql-server > 8.4'
# we do this to get postgresql84-server on RHEL 5
chkconfig postgresql on
# on Fedora 16 run:
postgresql-setup initdb
# everywhere else run:
service postgresql initdb

service postgresql start
}}}

Create database, user, and plpgsql language there:

{{{
su - postgres -c 'PGPASSWORD=spacepw; createdb spaceschema ; createlang plpgsql spaceschema ; yes $PGPASSWORD | createuser -P -sDR spaceuser'
}}}

Configure the user to use md5 password to connect to that database. Put the lines like following to
{{{/var/lib/pgsql/data/pg_hba.conf}}}. Avoid the common pitfall: '''Make sure you put them *before* those existing lines that are for {{{all}}}.'''.

{{{
local spaceschema spaceuser md5
host  spaceschema spaceuser 127.0.0.1/8 md5
host  spaceschema spaceuser ::1/128 md5
}}}

Then reload PostgreSQL:

{{{
service postgresql reload
}}}

and test the connection:

{{{
PGPASSWORD=spacepw psql -a -U spaceuser spaceschema
PGPASSWORD=spacepw psql -h localhost -a -U spaceuser spaceschema
}}}

Please note that you will want the TCP connection allowed as well because the JDBC driver cannot use the Unix domain socket. So even if the Python and Perl stack will use the Unix domain socket if you do not specify the hostname, JDBC will still go to localhost via TCP.

If you want to have the database on a separate box you will likely need to change this line in pg_hba.conf from 127.0.0.1/8 to something else:

{{{
host  spaceschema spaceuser 127.0.0.1/8 md5
}}}

and also to add line to /var/lib/pgsql/data/postgresql.conf 

{{{
listen_addresses = '*'
}}}

= Tune up PostgreSQL =

You can tune up performance of PostgreSQL by running pgtune:

 * download and install package from http://koji.fedoraproject.org/koji/packageinfo?packageID=13414
 * mkdir /usr/share/pgtune
 * pgtune -i /var/lib/pgsql/data/postgresql.conf >/tmp/pgtune.conf
 * Review the changes by diff -i /var/lib/pgsql/data/postgresql.conf /tmp/pgtune.conf
 * cp /var/lib/pgsql/data/postgresql.conf /var/lib/pgsql/data/postgresql.conf.bak
 * cp /tmp/pgtune.conf /var/lib/pgsql/data/postgresql.conf
 * restart postgresql service