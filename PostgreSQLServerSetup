
= Setup of the PostgreSQL database =

You should have PostgreSQL server running somewhere. Let's assume you will run the server on the same machine as Spacewalk itself:

{{{
yum install -y 'postgresql-server > 8.4'
# we do this to get postgresql84-server on RHEL 5
chkconfig postgresql on
service postgresql initdb
service postgresql start
}}}

Create database, user, and plpgsql language there:

{{{
su - postgres -c 'createdb spaceschema ; createlang plpgsql spaceschema ; createuser -P -sDR spaceuser'
}}}

Configure the user to use md5 password to connect to that database -- put lines like

{{{
local spaceschema spaceuser md5
host  spaceschema spaceuser 127.0.0.1/8 md5
host  spaceschema spaceuser ::1/128 md5
}}}

to {{{/var/lib/pgsql/data/pg_hba.conf}}}. Make sure you put them before those existing lines that are for {{{all}}}. Then reload PostgreSQL:

{{{
service postgresql reload
}}}

and test the connection:

{{{
PGPASSWORD=spacepw psql -a -U spaceuser spaceschema
PGPASSWORD=spacepw psql -h localhost -a -U spaceuser spaceschema
}}}

Please note that you will want the TCP connection allowed as well because the JDBC driver cannot use the Unix domain socket. So even if the Python and Perl stack will use the Unix domain socket if you do not specify the hostname, JDBC will still go to localhost via TCP.

If you want to have the database on a separate box you will likely need to change this line in pg_hba.conf from 127.0.0.1/8 to something else:

{{{
host  spaceschema spaceuser 192.168.0.0/16 md5
}}}
