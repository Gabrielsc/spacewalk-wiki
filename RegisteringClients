Instructions for registering client systems you with to manage with Spacewalk

= Before Starting =
  1. Create a base channel within Spacewalk (Channels > Manage Software Channels > Create New Channel)
  1. Create an activation key with the new base channel.
  1. Register the 
Fake the base channel to be a non-fedora one. We need to include fedora-release as a valid product in the db. This is get the registration working for RHEL-5 and get yum-plugin installed.


= Fedora 9 =

  1. Install the Spacewalk yum repository by creating a file in /etc/yum.repos.d with the following contents:
    {{{
[spacewalk]
name=Spacewalk
baseurl=http://spacewalk.redhat.com/yum/fedora/9/i386/
enabled=1
gpgcheck=1
}}}

  1. Install client packages:
    {{{
yum install rhn-client-tools rhn-check rhn-setup rhnsd
    }}}
    * TODO: is rhn-setup-gnome needed?
  1. Install a redhat-release rpm for rhel-5 or edit /usr/share/rhn/up2date_client/up2dateUtils.py's getRelease() to return '5Server'
  1. If we have a fedora channel with packages hosted on Spacewalk, We don't have to do this. We just register with an activation key and associate the custom fedora channel to this client.
{{{
  rhnreg_ks --user satadmin --pass password --force --serverUrl=http://YOURSATELLITEURL/XMLRPC --activationkey=<key-with-fedora-custom-channel> --nohardware
}}}
  1. Register your box to Spacewalk. Now this should go smoothly and you should see your fedora box subscribed to rhel-5 base channel.
  1. Install yum-rhn-plugin and run yum
  1. It should error while loading the plugin. disable the plugin /etc/yum/pluginconf.d/rhnplugin.conf
  1. Install m2crypto
  {{{
  $  yum install m2crypto
  Loading "security" plugin
  Setting up Install Process
  Parsing package install arguments
  Resolving Dependencies
  --> Running transaction check
  ---> Package m2crypto.i386 0:0.17-2 set to be updated
  --> Finished Dependency Resolution
  Running Transaction
    Installing: m2crypto                     ######################### [1/1]
  Installed: m2crypto.i386 0:0.17-2
  Complete!
  }}}
  1. Re-enable rhnplugin.conf and run yum
{{{
  $ sudo yum install rhnlib
  Loading "rhnplugin" plugin
  Loading "security" plugin
  rhel-i386-server-5        100% |=========================| 1.4 kB    00:00
  Setting up Install Process
  Parsing package install arguments
  Resolving Dependencies
  --> Running transaction check
  ---> Package rhnlib.noarch 0:2.2.5-1.el5 set to be updated
  --> Processing Dependency: python(abi) = 2.4 for package: rhnlib
  --> Running transaction check
  ---> Package compat-python24.i386 0:2.4.5-1.lvn7 set to be updated
  --> Finished Dependency Resolution
  Dependencies Resolved
  =============================================================================
   Package                 Arch       Version          Repository        Size
  =============================================================================
  Updating:
   rhnlib                  noarch     2.2.5-1.el5      rhel-i386-server-5   63 k
  Installing for dependencies:
   compat-python24         i386       2.4.5-1.lvn7     livna             5.6 M
  Transaction Summary
  =============================================================================
  Install      1 Package(s)
  Update       1 Package(s)
  Remove       0 Package(s)
  Total download size: 5.6 M
  Is this ok [y/N]:
}}}
  1. We should now have rhn-plugin functional on a fedora box.
