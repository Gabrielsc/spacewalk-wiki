== Release Cycles ==

Each Spacewalk release will be roughly two (2) months in duration. See [https://hosted.fedoraproject.org/spacewalk/roadmap Roadmap] for upcoming releases.

== Mechanics ==
We will build our non Fedora RPMs using an internal Red Hat instance of Koji.  

The Koji server lives at [http://koji.rhndev.redhat.com/koji spacewalk koji]
to build you need a user cert,  you need to ask Dennis for it
a spacewalk koji config file in ~/.koji/spacewalk-config
{{{
[koji]

;configuration for koji cli tool

;url of XMLRPC server
server = http://koji.spacewalkproject.org/kojihub

;url of web interface
weburl = http://koji.spacewalkproject.org/koji

;url of package download site
pkgurl = http://koji.spacewalkproject.org/packages

;path to the koji top directory
;topdir = /mnt/koji

;configuration for SSL athentication

;client certificate
cert = ~/.spacewalk.cert

;certificate of the CA that issued the client certificate
ca = ~/.spacewalk-ca.cert

;certificate of the CA that issued the HTTP server certificate
serverca = ~/.spacewalk-ca.cert
}}}
the ~/.spacewalk-ca.cert file can be found linked at the bottom of this page

== Get your packages tagged, get your packages built ==

The tito script can be used to tag and build packages from git. It can be found in rel-eng/bin/. (good candidate to add to your $PATH, although the script can be called directly)

To have a particular package in a Spacewalk release, we should know from which
commit we plan to take the code. To to that, I suggest you do
{{{
        tito build--srpm --test
}}}
and try to create test .src.rpm package.

Note that this .src.rpm will be created from your local HEAD (on
whatever branch your are), it will have that commit's SHA1 in name
and if will also appear in the .tar.gz within that .src.rpm. It's
done that way on purpose, so that .src.rpm from your local HEAD is
not confused with "official" package releases.

When you get .src.rpm, try to rpmbuild it on your Fedora and RHEL. Fix
any problems that appear, do more commits, revert commits, etc.

When you are happy with the .src.rpm, you should run:
{{{
        git pull
        tito tag 
}}}

and tag your HEAD with name-version-release, and push that commit and
tag to the upstream repository. Run
{{{
        gitk --all # to verify results
        git push
        git push --tags
}}}

'''IMPORTANT''': Do  not run rebase after tagging a package. If someone commits to master before you can push out your tag, you must either use git pull (without --rebase) and accept the merge commit that will be generated, or throw away your local changes, delete the tag locally, and start again. If you do a rebase, your commit ID will change (as it has been re-applied on top of the working tree) while your tag now points to a non-existent commit. If this happens the tag will not be buildable and package will need to be tagged again. (not the end of the world)

After you have your tag in the upstream repository, you
can do
{{{
	tito build --srpm
}}}
which will create .src.rpm, this time named with the version-release
of the latest tag for that package. 

To submit a build to whatever build system is configured for your current git repository and branch:
{{{
	tito build --release
}}}

In spacewalk.git this build srpms with appropriate dist tags and submit them to Koji tags as configured in global.build.py.props.

tito will call koji with "build --nowait" as arguments by default. If you need something more explicit you can add to ~/.spacewalk-build-rc:
{{{
KOJI_OPTIONS=-c ~/.koji/spacewalk-config build --nowait
}}}


== Branching a release ==
When we're nearing the end of a release cycle, we need to branch the release.

Make sure your {{{master}}} is clean and updated:
{{{
   git checkout master
   git pull (make sure things are clean)
}}}

Now create a local branch, where x.y is the release number, i.e. 0.2:
{{{
   git checkout -b spacewalk-x.y
}}}

Then, push your branch to the remote server, where x.y is the release number:
{{{
   git push origin spacewalk-x.y:refs/heads/SPACEWALK-x.y
}}}

Please note that all changes made to a branch must also be made to master. (git cherry-pick very useful for this)