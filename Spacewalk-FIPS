[[TOC]]

= Spacewalk and FIPS-140-2 =

== Introduction ==

''FIPS 140-2 (FIPS = Federal Information Processing Standard)'' is a U.S. government security standard used to accredit cryptographic modules. It outlines a set of requirements that must be adhered to by any US-government certified cryptographic module (hardware or software).

''' FIPS 140-2 Annexes: '''

* Annex A: Approved Security Functions
  * http://csrc.nist.gov/publications/fips/fips140-2/fips1402annexa.pdf
* Annex B: Approved Protection Profiles
  * http://csrc.nist.gov/publications/fips/fips140-2/fips1402annexb.pdf
* Annex C: Approved Random Number Generators
  * http://csrc.nist.gov/publications/fips/fips140-2/fips1402annexc.pdf
* Annex D: Approved Key Establishment Techniques
  * http://csrc.nist.gov/publications/fips/fips140-2/fips1402annexd.pdf

Operating systems supported by Spacewalk (RHEL, CentOS, Fedora) allow turning FIPS mode on. In FIPS mode, the operating system is doing integrity checking and enforces minimum configurations for FIPS-aware cryptography
software (OpenSSL, libgcrypt).

== Scope of support ==

Spacewalk 2.2 introduced support for FIPS 140-2 standard. Spacewalk support for the FIPS standard allows:

* Installing and running your Spacewalk on an operating system (RHEL, CentOS, Fedora) with FIPS mode on.
* Running your registered clients in FIPS mode.

== Implementation notes ==

The FIPS 140-2 standard does not allow to use MD5 algorithm for cryptographic / security purposes, nor would a FIPS enabled operating system allow to use MD5 algorithm for cryptography.

This restriction lead to two important implementation changes in Spacewalk:
* User passwords, previously encrypted with MD5 method, will (beginning with Spacewalk 2.2) be encrypted with SHA-256 algorithm.
* Client certificates (''/etc/sysconfig/rhn/systemid'') which the registered systems use to authenticate with the parent server contain an MD5 digest string. Since Spacewalk 2.2, the MD5-based authentication method had to be changed to SHA-256.

== Operations ==

Beginning with Spacewalk 2.2, all newly registered clients will be issued a certificate with SHA-256 authentication digest. Also, beginning with Spacewalk 2.2 passwords for all newly created user accounts will be encrypted
with SHA-256 method. Though whenever a user with MD5-encrypted password would change his password or even just successfully authenticate with Spacewalk (a successful webui login for example), his MD5-encrypted password
would be automatically converted to a SHA-256 encrypted password.

How will this change affect my Spacewalk operations?

=== Not interested in FIPS ===

If you're not planning to turn the FIPS mode on your Spacewalk server on, you won't have to do any changes in your Spacewalk operations:
* For Spacewalk installations, you will follow standard installation instructions.
* For Spacewalk upgrades, you will follow standard upgrade instructions.
* For client registrations, you will follow standard registration instructions.

You will hardly notice any changes in your Spacewalk's behavior.

=== I want to turn the FIPS mode on ===

==== New Spacewalk installations ====

It is possible to install Spacewalk 2.2 (or later) on an operating system already in FIPS mode. Standard Spacewalk installation instructions would apply here.
From the very beginning, all user passwords will be encrypted with SHA-256, all clients will be issued a SHA-256 certificate.

==== Spacewalk upgrades ====

If you're upgrading from a previous Spacewalk version, you will need to update user passwords and client certificates from the MD5 scheme to SHA-256.

Your procedure for turning the FIPS mode on would be:
1. Upgrade your Spacewalk, following the standard upgrade procedure. Don't turn the FIPS mode on just yet. If you'd turn the FIPS mode on now, your users would no longer be able to log into your Spacewalk (Spacewalk would not be able to authenticate them), nor would your clients be able to check in with the parent server (''rhn_check'', ''rhnsd'', ''osad'').
2. Update user passwords and client certificates from the MD5 scheme to SHA-256 (see the detailed procedure below).
3. After the password and certificate update successfully finishes, you can turn the FIPS mode on.

== Update of user passwords and client certificates ==

=== User passwords ===

For a proper Spacewalk functioning in FIPS mode, your user passwords need to be encrypted with SHA-256 algorithm. Users with MD5-encrypted password would no longer be able to authenticate in FIPS mode.

The list of users with MD5-encrypted password can be obtained with ''spacewalk-report'':

{{{
$ spacewalk-report users-md5 > users-md5.csv
}}}

Once you have the list of users requiring the password encryption update, you can:
1. Reset their password using ''satpasswd'' utility:
{{{
$ for i in $(cat users-md5.csv | awk -F, 'NR>1 { print $4 }'); do
      echo "Changing password for user $i";
      satpasswd $i;
      echo;
done
}}}

2. Instruct all of the users on the list to log into your Spacewalk's webui (no other action is needed). Any time a user with MD5-encrypted password successfully authenticates, Spacewalk will automatically convert his password from MD5 to SHA-256 encryption.