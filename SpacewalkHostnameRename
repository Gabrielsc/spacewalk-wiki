= spacewalk-hostname-rename =

spacewalk-hostname-rename script is an automated tool for re-configuration of Spacewalk server, in case its hostname or IP has changed.

It takes care of reconfiguration of /etc/rhn/rhn.conf file, SSL certificate, database, jabberd, cobbler, monitoring ... everything what's needed.

== Prerequisites ==
If you change the system hostname, make sure you know your SSL CA passphrase. It will be needed by the script.
Verify that CA password is working:
{{{
# openssl rsa -in ssl-build/RHN-ORG-PRIVATE-SSL-KEY
Enter pass phrase for ssl-build/RHN-ORG-PRIVATE-SSL-KEY:
writing RSA key
-----BEGIN RSA PRIVATE KEY-----
cut
-----END RSA PRIVATE KEY-----
}}}

 * Schedule a maintenance window for the rename process.
 * Change the hostname/ip of the system.
 * Reboot the system to ensure that the new hostname is active
 * Run the spacewalk-hostname-rename script

== How to use it ==

spacewalk-hostname-rename takes one mandatory argument - IP_ADDRESS regardless of whether the IP address has changed or not. If there is a need to generate a new SSL certificate, all necessary information will be asked interactivelly, unless it is specified by the options. When the system  hostname has not changed, the re-generation of a new SSL server certificate is not necessary. However, if at least one --ssl-*  option is specified, certificate generation is forced.

{{{
Usage:
   spacewalk-hostname-rename <IP_ADDRESS> [ --ssl-country=<SSL_COUNTRY> --ssl-state=<SSL_STATE> --ssl-org=<SSL_ORG> --ssl-orgunit=<SSL_ORGUNIT> --ssl-email=<SSL_EMAILl> --ssl-ca-password=<SSL_CA_PASSWORD>]
   spacewalk-hostname-rename { -h | --help }
}}}

IP_ADDRESS is the default ip address of the system used mainly for monitoring. It's a mandatory argument even if the IP didn't change.

== Rename process ==

{{{
# spacewalk-hostname-rename <my_ip_address>
Validating IP ... OK
=============================================
hostname: <my_hostname>
ip: <my_ip_address>
=============================================
Stopping rhn-satellite services ... OK
Testing DB connection ... OK
Updating /etc/rhn/rhn.conf ... OK
Actual SSL key pair package: rhn-org-httpd-ssl-key-pair-rlx-2-18.rhndev-1.0-6
 No need to re-generate SSL certificate.
Regenerating new bootstrap client-config-overrides.txt ... OK
Updating NOCpulse.ini ... OK
Updating monitoring data ... OK
Pushing monitoring scounts ... OK
Updating other DB entries ... OK
Changing cobbler settings ... OK
Changing jabberd settings ... OK
Starting rhn-satellite services ... OK
}}}

== Logging and backup ==

spacewalk-hostname-rename logs to /var/log/rhn/rhn_hostname_rename.log and all manually changed files get backup-ed with predefined .rhnbck extension.

== What about the clients? ==

Check serverURL value in /etc/sysconfig/rhn/up2date on every client registered to the renamed satellite and change it to the new hostname/ip value.
Reconfiguration of RHN Proxy servers isn't trivial and it's recommended to recreate RHN Proxy servers.

== Script failures ==

The script makes some initial checks, whether the hostname is correctly set. The most problems may pop-up because of wrongly set system hostname. The script would write a concrete error message what shall be fixed in these cases. After the problem gets removed, the script can be re-run.
