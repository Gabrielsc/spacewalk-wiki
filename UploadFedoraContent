= Upload content to Spacewalk =

In order to use Spacewalk, you need to populate it with content.  There are two ways to do this:
 1.  spacewalk repo sync (For syncing yum repos)
 2.  rhnpush (For simply pushing a rpms directly to the spacewalk server)

Before doing either of these things, you will need to create a custom software channel within spacewalk.


== Create Channel ==

The easiest way to create a channel is through. the WebUI.  Simply log in and navigate to the "Channels"->"Manage Software Channels"-> "Create"  page.  


Alternatively you can use the attached api script to create a channel from the command line. 

For example, to create a channel for Cent Os 5:
 {{{./create_channel.py --label=centos5-i386 --name "CentOS 5 32-bit" --summary "32-bit CentOS 5 channel"}}}

Usage:
{{{
./create_channel.py 
usage: create_channel.py [options] --label <channel label> --name <channel name>

options:
  -h, --help           show this help message and exit
  --user=USER          username
  --password=PASSWORD  password
  --host=HOST          FQDN of your server
  --label=LABEL        channel label
  --name=NAME          channel name
  --summary=SUMMARY    channel summary
  --channel-arch=ARCH  channel architecture
  --debug              enable debug output
None
}}}

Note: The channel name can't start with "Red Hat" (you will get an "Invalid Channel Name" error).




== Repo-sync ==

Intruduced in Spacewalk 0.6, repo sync was enhanced in Spacewalk 1.1. For version 1.1 and newer proceed as following :

Goto Channels -> Manage Software Channels -> Manage Repositories -> create new repository

[[Image(spacewalk_reposync_v1_2_scaled.jpeg)]]

After creating the repository, you need to link it to one or more Software Channels. Goto: Channels -> Manage Software Channels -> Choose the channel to be linked -> Repositories -> Select the repositories to be linked to the channel -> Update Repositories. Now you can sync the repository clicking on the sync tab. Click on sync now or schedule a sync.

Alternatively you can start a sync by command line:

{{{
spacewalk-repo-sync -c your-channel -t yum 
}}}

The logs are stored in /var/log/rhn/reposync/

If you would prefer to sync using the command line, you can use the 'spacewalk-repo-sync' command.  It's usage is:
{{{
spacewalk-repo-sync --channel CHANNEL_LABEL --url YUM_URL
}}}
for example, to sync CentOs 5 to your custon 'centos5-i386' channel you would run:
{{{
/usr/bin/spacewalk-repo-sync --channel centos5-i386 --url http://mirrors.kernel.org/centos/5/os/i386/
}}}


Currently only 'yum' type is supported.  You can use any repo url that is supported by yum (http://, file://, etc...).  If running the command line directly, you must be the root user.

If, when doing a spacewalk-repo-sync, you get a "yum.Errors.NoMoreMirrorsRepoError" error then you need to install python-hashlib.

== rhnpush ==

If the packages you are wanting to push to the Spacewalk server are not in a yum repository, you can push them directly using the rhnpush tool.


For example, to upload a directory of packages called 'dir_of_packges' to the channel 'my-custom-channel':
{{{
rhnpush -v --channel=my-custom-channel --server=http://localhost/APP --dir=dir_of_packages
}}}

Note: Make sure {{{/var/satellite}}} exists on the Spacewalk server and has owner:group {{{apache}}} before pushing. The -v option causes progress information to be printed, e.g.:

{{{
# rhnpush -v --channel=rhel-x86_64-server-5 --server=http://localhost/APP --dir=update
Connecting to http://localhost/APP
Package /root/update/xorg-x11-drv-vga-4.1.0-2.1.x86_64.rpm Not Found on RHN Server -- Uploading
Uploading package /root/update/xorg-x11-drv-vga-4.1.0-2.1.x86_64.rpm
Using POST request
Package /root/update/gnome-python2-gconf-2.16.0-1.fc6.x86_64.rpm Not Found on RHN Server -- Uploading
Uploading package /root/update/gnome-python2-gconf-2.16.0-1.fc6.x86_64.rpm
Using POST request
}}}

Note: I found that the above failed on Fedora 9 Everything.  My work around was
{{{
find . -name "*rpm" | xargs rhnpush --channel=fedora-9-i386 --server=http://localhost/APP -v --tolerant -u spacewalk -p spacewalk
}}}

Note: The directory you pass as --dir=suchandsuch HAS TO contain the RPMs. rhnpush won't descend into directories to find RPMs.
      Also, I had to put the -v at the end of the group of parameters.
        --onekopaka

Note: If you are running rhnpush from a box that is NOT your spacewalk server, use the correct hostname in the --server param

== Channel-to-update == 
If you are using CenOS or RHEL content, and wish to create channels according to an update level.  You may be interested in this script [https://fedorahosted.org/spacewalk/wiki/channel-to-update here].

== Regularly syncing yum repositories ==

This [https://fedorahosted.org/spacewalk/attachment/wiki/UploadFedoraContent/sync_repos.py script] will get the yum repo information out of the oracle database and trigger spacewalk-repo-sync for every channel that has a yum repository. You can run it from cron to sync your repositories on a regular basis.
