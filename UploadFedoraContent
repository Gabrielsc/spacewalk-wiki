= Upload content to Spacewalk =

In order to use Spacewalk, you need to populate it with content.  There are two ways to do this:
 1.  spacewalk repo sync (For syncing yum repos)
 2.  rhnpush (For simply pushing a rpms directly to the spacewalk server)

Before doing either of these things, you will need to create a custom software channel within spacewalk.


== Create Channel ==

The easiest way to create a channel is through. the WebUI.  Simply log in and navigate to the "Channels"->"Manage Software Channels"-> "Create"  page.  


Alternatively you can use the attached api script to create a channel from the command line. 

For example, to create a channel for Cent Os 5:
 {{{./create_channel.py --label=centos5-i386 --name "CentOS 5 32-bit" --summary "32-bit CentOS 5 channel"}}}

Usage:
{{{
./create_channel.py 
usage: create_channel.py [options] --label <channel label> --name <channel name>

options:
  -h, --help           show this help message and exit
  --user=USER          username
  --password=PASSWORD  password
  --host=HOST          FQDN of your server
  --label=LABEL        channel label
  --name=NAME          channel name
  --summary=SUMMARY    channel summary
  --channel-arch=ARCH  channel architecture
  --debug              enable debug output
None
}}}

Note: The channel name can't start with "Red Hat" (you will get an "Invalid Channel Name" error).




== Repo-sync ==

New in Spacewalk 0.6, we now support syncing directly with yum repositories:

[[Image(reposync.jpg)]]

On the channel details page ("Channels"->"Manage Software Channels"-> click on your channel), you can configure the yum repository to sync against.  Simply enter the repository URL, and a label.  The label can be anything, but it is used mainly for logging and caching purposes.  If you would like to go ahead and start a sync, simply check the 'Sync Repo' box before submitting the page.  After initiating a sync, it should begin in a minute or two (as long as another sync is not already in progress, in which case it will start once that one is done).  Once the sync starts, the 'last sync time' will become a link and you can click on it to view the log file of the current sync.  These logs are stored in /var/log/rhn/reposync/

Anytime you would like to re-sync the repo, simply revisit this details page, check 'Sync Repo' and hit update.  In the future we hope to add scheduled syncs in so you can sync every night for example. 


If you would prefer to sync using the command line, you can use the 'spacewalk-repo-sync' command.  It's usage is:
{{{
spacewalk-repo-sync --channel CHANNEL_LABEL --URL YUM_URL --label REPO_LABEL --type TYPE
}}}
for example, to sync CentOs 5 to your custon 'centos5-i386' channel you would run:
{{{
/usr/bin/spacewalk-repo-sync --channel centos5-i386 --url http://mirrors.kernel.org/centos/5/os/i386/ --type yum --label centos5-base
}}}

Currently only 'yum' type is supported.  You can use any repo url that is supported by yum (http://, file://, etc...).  If running the command line directly, you must be the root user.



== rhnpush ==

If the packages you are wanting to push to the Spacewalk server are not in a yum repository, you can push them directly using the rhnpush tool.


For example, to upload a directory of packages called 'dir_of_packges' to the channel 'my-custom-channel':
{{{
rhnpush -v --channel=my-custom-channel --server=http://localhost/APP --dir=dir_of_packages
}}}

Note: Make sure {{{/var/satellite}}} exists on the Spacewalk server and has owner:group {{{apache}}} before pushing. The -v option causes progress information to be printed, e.g.:

{{{
# rhnpush -v --channel=rhel-x86_64-server-5 --server=http://localhost/APP --dir=update
Connecting to http://localhost/APP
Package /root/update/xorg-x11-drv-vga-4.1.0-2.1.x86_64.rpm Not Found on RHN Server -- Uploading
Uploading package /root/update/xorg-x11-drv-vga-4.1.0-2.1.x86_64.rpm
Using POST request
Package /root/update/gnome-python2-gconf-2.16.0-1.fc6.x86_64.rpm Not Found on RHN Server -- Uploading
Uploading package /root/update/gnome-python2-gconf-2.16.0-1.fc6.x86_64.rpm
Using POST request
}}}

Note: I found that the above failed on Fedora 9 Everything.  My work around was
{{{
find . -name "*rpm" | xargs rhnpush --channel=fedora-9-i386 --server=http://localhost/APP -v --tolerant -u spacewalk -p spacewalk
}}}

Note: The directory you pass as --dir=suchandsuch HAS TO contain the RPMs. rhnpush won't descend into directories to find RPMs.
      Also, I had to put the -v at the end of the group of parameters.
        --onekopaka

Note: If you are running rhnpush from a box that is NOT your spacewalk server, use the correct hostname in the --server param

== Channel-to-update == 
If you are using CenOS or RHEL content, and wish to create channels according to an update level.  You may be interested in this script [https://fedorahosted.org/spacewalk/wiki/channel-to-update here].
