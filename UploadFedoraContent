= Upload content to Spacewalk =

In order to use Spacewalk, you need to upload content to it. At the moment there is no nice way to sync a yum repo.
In this example, I'll describe how to upload Fedora 9 content into Spacewalk. Basically, here are the steps:
 - create channel to hold the content
 - download the content from a yum repo
 - upload the content to Spacewalk


Important Note:  currently due to the way Spacewalk handles packages you can only manage one distribution in an org at a time.  This is not what we want and is definitely something we want to fix very soon now.  Mixed environments are something we want to support.  So for example, right now, you can have one organization for Red Hat Enterprise Linux content, one organization for CentOS content, and one organization for Fedora content.  Servers cannot be in multiple organizations.  The technical reason for this is that Fedora 9, CentOS 5, and RHEL 5 all contain packages with the same EVRA (Epoch, Version, Release, Arch), and Satellite cannot currently differentiate between packages from different sources with the same EVRA.  We hope to have this fixed soon so co-management of Fedora, CentOS, and RHEL is possible.  You can however have multiple versions of the same distribution (F-8, F-9, etc) within the same org.


== create channel ==

In order to upload content to Spacewalk, you'll need a channel to contain the packages. Attached you will find a script that can be used to create the channel using the available XML-RPC API.

For example, to create a channel for Fedora 9:
 {{{./create_channel.py --label=fedora-9-i386 --name "Fedora 9 32-bit" --summary "32-bit Fedora 9 channel"}}}

=== usage ===

{{{
./create_channel.py 
Usage: create_channel.py [options] --label <channel label> --name <channel name>

Options:
  -h, --help           show this help message and exit
  --user=USER          username
  --password=PASSWORD  password
  --host=HOST          FQDN of your server
  --label=LABEL        channel label
  --name=NAME          channel name
  --summary=SUMMARY    channel summary
  --debug              enable debug output
None
}}}

== download content ==
There are many ways to download content rsync, wget, reposync, etc. Below we'll show two of these mechanisms: wget and reposync.

=== wget ===
One way of getting content is to simply use wget to suck down the packages from a given yum repo. While not the most elegant method, it works, using easily available tools. Let's get the Fedora 9 content and put them into a Fedora9 directory.

 - {{{mkdir Fedora9}}}
 - {{{cd Fedora9}}}
 - {{{wget -r -l1 --no-parent \}}}
   {{{   http://download.fedora.redhat.com/pub/fedora/linux/releases/9/Everything/i386/os/Packages/}}}

=== fetching content using reposync ===
A more elegant method of getting packages for uploading, is using reposync. [http://wiki.linux.duke.edu/YumUtils YumUtils] has a really useful tool called [http://wiki.linux.duke.edu/YumUtils/RepoSync reposync] to synchronize packages to a local directory.

 - First, install it: {{{ yum install yum-utils}}}
 - Install the desired repo in this case, fedora.
 - 
{{{
   $ head /etc/yum.repos.d/fedora.repo
   [fedora]
   name=Fedora $releasever - $basearch
   baseurl=http://download.fedora.redhat.com/pub/fedora/linux/releases/$releasever/Everything/$basearch/os/
   mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=$basearch
   enabled=1
   gpgcheck=1
   gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora file:///etc/pki/rpm-gpg/RPM-GPG-KEY
   }}}

 - Now pass in the repoid to reposync:
 {{{
$ reposync --repoid=fedora
[fedora: 1     of 7390  ] Downloading Fedora/915resolution-0.5.3-1.fc7.i386.rpm
  915resolution-0.5.3-1.fc7 100% |=========================|  16 kB    00:00     
[fedora: 2     of 7390  ] Downloading Fedora/AGReader-1.2-2.fc6.i386.rpm
  AGReader-1.2-2.fc6.i386.r 100% |=========================|  47 kB    00:00     
[fedora: 3     of 7390  ] Downloading Fedora/AllegroOGG-1.0.3-3.fc6.i386.rpm
  AllegroOGG-1.0.3-3.fc6.i3 100% |=========================|  16 kB    00:00
  ...
}}}
 - Once the above step is done packages should be in the {{{fedora}}} directory:
 {{{
$ ls -l fedora/Fedora/
  total 18936
  -rw-rw-r-- 1 root root   15960 2007-05-23 10:18 915resolution-0.5.3-1.fc7.i386.rpm
  -rw-rw-r-- 1 root root   48528 2007-05-23 10:18 AGReader-1.2-2.fc6.i386.rpm
  -rw-rw-r-- 1 root root   16687 2007-05-23 10:19 AllegroOGG-1.0.3-3.fc6.i386.rpm
  ...
 }}}

== push the content ==
Finally, time to push the content into the server. Once you have the rpms, use {{{rhnpush}}} to push them to the Spacewalk server.

For example, to upload the content downloaded using {{{reposync}}} do the following:
 {{{rhnpush --channel=fedora-9-i386 --server=http://localhost/APP --dir=fedora }}}

=== usage ===
 {{{rhnpush --channel=<channel-label> --server=<hosturl>/APP --dir=<directory> }}}

Note: Make sure {{{/var/satellite}}} exists and has owner:group {{{apache}}} before pushing.

Note: I found that the above failed on Fedora 9 Everything.  My work around was
 {{{find . -name "*rpm" | xargs rhnpush --channel=fedora-9-i386 --server=http://localhost/APP -v --tolerant -u spacewalk -p spacewalk}}}
