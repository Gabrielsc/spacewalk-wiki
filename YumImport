= PROTOSPEC DOCUMENT =
=== TOPIC: Import content from a Yum repo ===
=== REQUESTOR: jmrodri ===
=== REVIEWED BY: ===
=== RELEASE: Spacewalk 0.6 ===

== Overview ==
Make it easier to import content into Spacewalk. Today a user must download a repo locally then upload the packages via {{{rhnpush}}}.
See UploadFedoraContent for an explanation of what is involved.


== Requirements == 

* User wants to sync Fedora repo to a channel
* User has private yum repo and wants to bring that into his spacewalk server


== Other Feature Impact ==
None

== Proposed Implementation ==

 * UI
  * Channel Creation Page
    * add URL widget to allow one to define the yum repo.
    * add a check box to indicate if channel should be synced after creation
  * Channel Edit Page 
    * Add a URL widget to allow one to change the yum repo.
    * Add a sync button
  * sync task will be performed asynchronously.  
  * Sync only be additive, packages removed from the yum repo will remain in the channel
  * To initiate sync, task is added to new Taskomatic queue
 * Taskomatic task will pick up from queue and use new yum repo module
 * Yum Repo interaction will use Yum module from jopr
 * Api support for syncing channel, setting repo
 * Schema Changes
  * Add rhnChannelRepo table to store  repo -> channel (many-to-one) mapping
 * Config option will be added to disable all Yum UI snippets and API calls

     
== SAMPLE CODE ==
=== Channel creation page ===

Sample image of what kickstart details will look like (minus the 'sync schedule feature')

[[Image(channel-creation.png, 20%)]]

== WORK ITEMS ==

 * Add schema to support associated yum repo(s) with channel (allow future support of multiple repos)
 * Add schema to support new Taskomatic task
 * Integrate Jopr's yum syncing module in
 * Create new Taskomatic Task
 * Add UI support for setting yum repo and doing initial sync (asynchronously) 
 * Add UI support for syncing all channels (asynchronously) 
 * New Apis:  (working names)
  * channel.software.repo.set
  * channel.software.repo.sync  
  * channel.software.repo.syncAll  


== TEST PLAN ==
Need to test syncing mechanism, as well as the resulting packages and channels to ensure they were created properly



== RISKS/CONCERNS ==
Reading GPG key from package file

== Future Features ==
[wiki:YumImport2 link]

