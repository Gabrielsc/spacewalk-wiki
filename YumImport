= PROTOSPEC DOCUMENT =
=== TOPIC: Import content from a Yum repo ===
=== REQUESTOR: jmrodri ===
=== REVIEWED BY: ===
=== RELEASE: Spacewalk 0.6 ===

== Overview ==
Make it easier to import content into Spacewalk. Today a user must download a repo locally then upload the packages via {{{rhnpush}}}.
See UploadFedoraContent for an explanation of what is involved.


== Requirements == 

* User wants to sync Fedora repo to a channel
* User has private yum repo and wants to bring that into his spacewalk server


== Other Feature Impact ==
None

== Proposed Implementation ==

 * UI
  * Channel Creation Page
    * add URL widget to allow one to define the yum repo.
    * add a check box to indicate if channel should be synced after creation
  * Channel Edit Page 
    * Add a URL widget to allow one to change the yum repo.
    * Add a sync button
  * sync task will be performed asynchronously.  
  * Sync only be additive, packages removed from the yum repo will remain in the channel
  * To initiate sync, task is added to new Taskomatic queue
 * Taskomatic task will pick up from queue and use new yum repo module
 * Yum Repo interaction will use Yum module from jopr
 * Api support for syncing channel, setting repo (working titles)
  * channel.software.repo.set
  * channel.software.repo.sync  
  * channel.software.repo.syncAll  
 * Schema Changes
  * Add rhnChannelRepo table to store  repo -> channel (many-to-one) mapping
 * Config option will be added to disable all Yum UI snippets and API calls

     
== SAMPLE CODE ==
=== Channel creation page ===

Sample image of what kickstart details will look like (minus the 'sync schedule feature')

[[Image(channel-creation.png, 20%)]]

== WORK ITEMS ==

|| Task ||   Estimate || Confidence ||
|| Schema changes (repo & taskomatic) || 1 day || 5  ||
|| Integrate Jopr's yum syncing module ||      ||    ||
|| Adding support code for repo syncing ||     ||    ||
|| Taskomatic Additions              ||  2 days      || 4   ||
|| UI Changes      ||  2 Days || 5 ||
|| Apis            ||  2 Days || 5 ||
|| Update Spacewalk Docs || 1 Day || 5 ||



== TEST PLAN ==
Need to test syncing mechanism, as well as the resulting packages and channels to ensure they were created properly



== RISKS/CONCERNS ==
Reading GPG key from package file

== Future Features ==
[wiki:YumImport2 link]

