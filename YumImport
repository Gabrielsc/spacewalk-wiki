= PROTOSPEC DOCUMENT =
=== TOPIC: Import content from a Yum repo ===
=== REQUESTOR: jmrodri ===
=== REVIEWED BY: ===
=== RELEASE: Spacewalk 0.6 ===

== BUSINESS DEFINITION ==
Make it easier to import content into Spacewalk. Today a user must download a repo locally then upload the packages via {{{rhnpush}}}.
See UploadFedoraContent for an explanation of what is involved.

== OTHER FEATURE IMPACT ==
== PROPOSED IMPLEMENTATION ==
 * UI
  * Add a URL widget to the Channel Edit page to allow one to define the yum repo.
  * when user hits 'sync', task will be performed asynchronously.  
  * Will only be additive, packages removed from the yum repo, will remain in the channel
 * Yum Repo interaction will use Yum module from jopr
 * Api support for syncing channel, setting repo
 * Schema Changes
  * Add rhnChannelRepo table to store  repo -> channel (many-to-one) mapping

== USE CASES == 


=== WebUI ===

Add the following section to the Channel creation page.

[[Image(channel-creation-repo-info.png)]]
      
== SAMPLE CODE ==
=== Channel creation page ===
[[Image(channel-creation.png, 50%)]]
== WORK ITEMS ==

 * Add schema to support associated yum repo(s) with channel (allow future support of multiple repos)
 * Integrate Jopr's yum syncing module in
 * Add UI support for setting yum repo and doing initial sync (asynchronously) 
 * Add UI support for syncing all channels (asynchronously) 
 * New Apis:  (working names)
  * channel.software.repo.set
  * channel.software.repo.sync  


== TEST PLAN ==


== RISKS/CONCERNS ==
`


=== Future Features (Part 2) ===

* Do a full sync from channel to repo (remove packages if removed)
* support multiple yum repos -> one channel
* Command Line support
* Background periodic (daily, hourly, etc) syncing


=== Command line: (prad) (future) ===
      * Sync a remote repo to spacewalk database
        * ''Heads on on the --db syntax. This is incompatible with PostgreSQL and had to be changed for all scripts in that branch. I know with some scripts we setup to not have to specify a database at all (just use the default in rhn.conf), but you could if you wanted to. (in which case you need the full range of options, backend, user, password, host, port, etc, not all of which would be used in the case of Oracle)'' - dgoodwin
           
{{{
      $ ./sw-repo-sync --repo=remote-url --channel=fedora-10-repo --db=user/pass@db
}}}

      * Sync a local repo to spacewalk db
                  
{{{
      $ ./sw-repo-sync --repo=/path/to/local-repo --channel=fedora-10-repo --db=user/pass@db
}}}

      * Sync only the newest packages from the remote or local repo 

{{{
      $./sw-repo-sync --newest --repo=remote-url --channel=fedora-10-repo  --db=user/pass@db
}}}

      * Sync remote repo only to a local filer (/var/satellite)             

{{{
      $ ./sw-repo-sync --repo=remote-url --local
}}}
              
      * Notify user once sync is complete
                    
{{{
      $ ./sw-repo-sync --repo=remote-repo --notify=admin@example.com
}}}

      * Schedule a recurring task
       
{{{
      $ ./sw-repo-sync --repo=remote-repo --schedule="30 1 * * *"
}}}
