= PROTOSPEC DOCUMENT =
=== TOPIC: Import content from a Yum repo ===
=== REQUESTOR: jmrodri ===
=== REVIEWED BY: ===
=== RELEASE: Spacewalk 0.6 ===

== BUSINESS DEFINITION ==
Make it easier to import content into Spacewalk. Today a user must download a repo locally then upload the packages via {{{rhnpush}}}.
See UploadFedoraContent for an explanation of what is involved.

== OTHER FEATURE IMPACT ==
== PROPOSED IMPLEMENTATION ==
 * UI
  * Add a URL widget to the Channel Edit page to allow one to define the yum repo.
 * Server-side
  * Add a server-side task to download the packages from the yum repo and 
  * The implementation would be similar to already existing reposync tool in yum-utils. We'll need to go a extra mile to import it into the database and tie it to a channel. May be call it sw-repo-sync.(prad)
  * sw-repo-sync will inherit functionality from repo-sync and do few extra methods. (prad)
== USE CASES == 
=== Command line: (prad) ===
      * Sync a remote repo to spacewalk database
        * ''Heads on on the --db syntax. This is incompatible with PostgreSQL and had to be changed for all scripts in that branch. I know with some scripts we setup to not have to specify a database at all (just use the default in rhn.conf), but you could if you wanted to. (in which case you need the full range of options, backend, user, password, host, port, etc, not all of which would be used in the case of Oracle)'' - dgoodwin
           
{{{
      $ ./sw-repo-sync --repo=remote-url --channel=fedora-10-repo --db=user/pass@db
}}}

      * Sync a local repo to spacewalk db
                  
{{{
      $ ./sw-repo-sync --repo=/path/to/local-repo --channel=fedora-10-repo --db=user/pass@db
}}}

      * Sync only the newest packages from the remote or local repo 

{{{
      $./sw-repo-sync --newest --repo=remote-url --channel=fedora-10-repo  --db=user/pass@db
}}}

      * Sync remote repo only to a local filer (/var/satellite)             

{{{
      $ ./sw-repo-sync --repo=remote-url --local
}}}
              
      * Notify user once sync is complete
                    
{{{
      $ ./sw-repo-sync --repo=remote-repo --notify=admin@example.com
}}}

      * Schedule a recurring task
       
{{{
      $ ./sw-repo-sync --repo=remote-repo --schedule="30 1 * * *"
}}}


=== WebUI ===

Add the following section to the Channel creation page.

[[Image(channel-creation-repo-info.png)]]
      
== SAMPLE CODE ==
=== Channel creation page ===
[[Image(channel-creation.png, 50%)]]
== WORK ITEMS ==
== TEST PLAN ==
== RISKS/CONCERNS ==